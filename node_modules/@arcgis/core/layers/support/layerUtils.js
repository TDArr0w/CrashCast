/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{id as e}from"../../kernel.js";import t from"../../request.js";import n from"../../core/Collection.js";import"../../core/urlUtils.js";import{isLayerFromCatalog as r}from"../catalog/catalogUtils.js";import{isBasemap as i}from"../../support/userTypeGuards/isBasemap.js";function u(e){return h(e)||f(e)}function o(e){return null!=e&&"object"==typeof e&&"type"in e&&"feature"===e.type}function s(e){return null!=e&&"object"==typeof e&&"type"in e&&"graphics"===e.type}function c(e){return null!=e&&"object"==typeof e&&"type"in e&&"map-image"===e.type}function a(e){return null!=e&&"object"==typeof e&&"type"in e&&"map-notes"===e.type&&"sublayers"in e}function l(e){return null!=e&&"object"==typeof e&&"type"in e&&"knowledge-graph"===e.type&&"layers"in e}function p(e){return null!=e&&"object"==typeof e&&"type"in e&&"knowledge-graph-sublayer"===e.type}function y(e){return null!=e&&"object"==typeof e&&"type"in e&&"link-chart"===e.type&&"layers"in e}function f(e){return"scene"===e?.type}function g(e){return b(e)||S(e)}function b(e){return"elevation"===e.type||"base-elevation"===e.type}function d(e){return null!=e&&"object"==typeof e&&"type"in e&&"subtype-group"===e.type&&"sublayers"in e}function m(e){return"subtype-sublayer"===e?.type}function h(e){const t=e?.type;return"imagery-tile"===t||"tile"===t||"open-street-map"===t||"vector-tile"===t||"web-tile"===t||"wmts"===t}function j(e){const t=e?.type;return"base-tile"===t||"tile"===t||"elevation"===t||"imagery-tile"===t||"base-elevation"===t||"open-street-map"===t||"wcs"===t||"web-tile"===t||"wmts"===t||"vector-tile"===t}function v(e){return null!=e&&"type"in e&&"group"===e.type}const w={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"};function L(e){const t=e?.type;return"building-scene"===t||"integrated-mesh"===t||"point-cloud"===t||"scene"===t}function S(e){return"integrated-mesh"===e.type||"integrated-mesh-3dtiles"===e.type}function E(e){return"integrated-mesh-3dtiles"===e.type}function k(e){return"voxel"===e?.type}function C(e){return"imagery-tile"===e?.type}function x(e,t){return i(e?.parent)&&e.parent[t].includes(e)}function T(e){return x(e,"baseLayers")}function U(e){return x(e,"referenceLayers")}function M(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type}function O(e){const t=e?.type;return("feature"===t||"subtype-group"===t||"oriented-imagery"===t)&&"feature-layer"===e?.source?.type}function B(e){return"feature"===e?.type&&"feature-layer"===e.source?.type}function I(e){return o(e)&&B(e)}function P(e){const t=/[:;]/,n=[];let r=!1;if(e&&(e.forEach((e,i)=>{n.push([i,e]),!r&&t.test(e)&&(r=!0)}),n.length>0)){let e;if(r){const t={};n.forEach(e=>{t[e[0]]=e[1]}),e=JSON.stringify(t)}else{const t=[];n.forEach(e=>{t.push(e[0]+":"+e[1])}),e=t.join(";")}return e}return null}function q(e){if(!e)return;const t=[];return e.forEach((e,n)=>{t.push('"'+n+'":'+JSON.stringify(e))}),t.length?"{"+t.join(",")+"}":void 0}function J(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const n=e.activeLayer.tileMatrixSets;if(n)return n}return null}async function N(n,r){const i=e?.findServerInfo(n);if(null!=i?.currentVersion)return i.owningSystemUrl||null;const u=n.toLowerCase().indexOf("/rest/services");if(-1===u)return null;const o=`${n.slice(0,u)}/rest/info`,s=null!=r?r.signal:null,{data:c}=await t(o,{query:{f:"json"},responseType:"json",signal:s});return c?.owningSystemUrl||null}function D(e){if(!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function F(e){return null!=e&&"object"==typeof e&&"isTable"in e&&!!e.isTable}function G(e){return D(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null}function V(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":case"knowledge-graph-sublayer":return!0;default:return!1}}function $(e){return!!V(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)}function z(e){if(!e)return[];return("subtypes"in e?e.subtypes:d(e.parent)?e.parent.subtypes:[])??[]}function A(e){return("imagery"===e.type||"imagery-tile"===e.type)&&"flow"===e.renderer?.type}function H(e){const t=new n;for(const n of e.allLayers.concat(e.allTables))"csv"===n.type||r(n)||("charts"in n&&t.push(n),"subtype-group"===n.type&&t.push(...n.sublayers));return t}function K(e,t){return null}function Q(e){return null}function R(e){return!e||"Feature Service"===e.type&&!e.sourceUrl}function W(e,t){if(!t||!R(e))return;const n=K(e.url);n&&(e.url=n)}export{W as applyPreferredHostToPortalItem,$ as getEffectiveEditingEnabled,G as getEffectiveLayerCapabilities,H as getLayersWithChartSupport,N as getOwningPortalUrl,Q as getPreferredHost,K as getPreferredUrl,z as getSubtypesFromLayer,J as getTileMaxtrixSetFromActiveLayer,T as isBaseLayer,u as isBasemap3DSupportedLayer,h as isBasemapSupportedTiledLayer,b as isElevationLayer,M as isFeatureCollectionLayer,o as isFeatureLayer,B as isFeatureServiceLayer,s as isGraphicsLayer,g as isGroundElevationLayer,v as isGroupLayer,C as isImageryTileLayer,E as isIntegratedMesh3DTilesLayer,S as isIntegratedMeshLayer,l as isKnowledgeGraphLayer,p as isKnowledgeGraphSublayer,D as isLayerWithFeatureCapabilities,O as isLayerWithFeatureLayerSource,A as isLayerWithFlowRenderer,y as isLinkChartLayer,c as isMapImageLayer,a as isMapNotesLayer,R as isPreferredUrlApplicable,U as isReferenceLayer,f as isSceneLayer,L as isSceneServiceLayer,d as isSubtypeGroupLayer,m as isSubtypeSublayer,F as isTable,j as isTiledLayer,k as isVoxelLayer,w as sceneServiceLayerTypeToClassName,P as serializeLayerDefinitions,q as serializeTimeOptions,I as supportsFieldConfiguration};
