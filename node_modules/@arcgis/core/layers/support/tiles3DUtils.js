/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{rad2deg as e}from"../../core/mathUtils.js";import{e as t,g as r,t as n,d as o,A as i,z as s,a as m}from"../../chunks/vec32.js";import{fromValues as a,create as h}from"../../core/libs/gl-matrix-2/factories/vec3f64.js";import{WGS84ECEFSpatialReferenceLike as l}from"../../geometry/ellipsoidUtils.js";import c from"../../geometry/Extent.js";import f from"../../geometry/HeightModelInfo.js";import x from"../../geometry/SpatialReference.js";import{projectBuffer as g}from"../../geometry/projection/projectBuffer.js";function u(e,t){if(!Array.isArray(e)||e.length<t)return!1;for(const r of e)if("number"!=typeof r)return!1;return!0}const d=7645211,p={xmin:-180,ymin:-90,zmin:-450,xmax:180,ymax:90,zmax:8850},S=new Map([[5773,new f({heightModel:"gravity-related-height",heightUnit:"meters",vertCRS:"EGM96_Geoid"})],[3855,new f({heightModel:"gravity-related-height",heightUnit:"meters",vertCRS:"EGM2008_Geoid"})],[115700,new f({heightModel:"ellipsoidal",heightUnit:"meters",vertCRS:"WGS_1984"})],[115701,new f({heightModel:"ellipsoidal",heightUnit:"meters",vertCRS:"ETRS_1989"})],[6360,new f({heightModel:"gravity-related-height",heightUnit:"us-feet",vertCRS:"NAVD88_height_(ftUS)"})],[7837,new f({heightModel:"gravity-related-height",heightUnit:"meters",vertCRS:"DHHN2016_(height) "})]]);function _(e){if(!e)return null;const t=e.vcsWkid||e.latestVcsWkid;return t?S.get(t):null}function R(e){return!(!(e.extensions?.ESRI_crs?.wkid||e.extensions?.ESRI_crs?.latestWkid||e.extensions?.ESRI_crs?.wkt)||!e.root?.extensions?.ESRI_crs?.boundingVolume?.box&&!e.root?.extensions?.ESRI_crs?.boundingVolume?.sphere)}function E(f,S=!1){let _=new x({wkid:4326,vcsWkid:115700}),R=f.root?.boundingVolume,E=!1,b=f?.root?.transform;if(S&&(f.extensions?.ESRI_crs?.wkid||f.extensions?.ESRI_crs?.latestWkid||f.extensions?.ESRI_crs?.wkt)&&(f.root?.extensions?.ESRI_crs?.boundingVolume?.box||f.root?.extensions?.ESRI_crs?.boundingVolume?.sphere))_=new x(f.extensions?.ESRI_crs),R=f.root?.extensions?.ESRI_crs?.boundingVolume,b=f.root?.transform,E=!0;else if(!R)return new c(-180,-90,180,90,_);if(R.box){const e=R?.box;if(e[3]>d&&e[7]>d&&e[11]>d)return new c({...p,spatialReference:_})}const w=h();if(!E&&R.region&&u(R.region,6)){const t=R.region,r=e(t[0]),n=e(t[1]),o=t[4],i=e(t[2]),s=e(t[3]),m=t[5];return new c({xmin:r,ymin:n,zmin:o,xmax:i,ymax:s,zmax:m,spatialReference:_})}if(R.sphere&&u(R.sphere,4)){const e=R.sphere,m=a(e[0],e[1],e[2]),f=e[3]/Math.sqrt(3),d=h();t(d,m,a(f,f,f));const p=h();if(r(p,m,a(f,f,f)),b&&u(b,16)){const e=b;n(w,d,e),o(d,w),n(w,p,e),o(p,w)}E||(g(d,l,0,d,x.WGS84,0),g(p,l,0,p,x.WGS84,0));const S=h(),y=h();return i(S,d,p),s(y,d,p),new c({xmin:S[0],ymin:S[1],zmin:S[2],xmax:y[0],ymax:y[1],zmax:y[2],spatialReference:_})}if(R.box&&u(R.box,12)){const e=R.box,t=a(e[0],e[1],e[2]),o=a(e[3],e[4],e[5]),f=a(e[6],e[7],e[8]),d=a(e[9],e[10],e[11]),p=[];for(let r=0;r<8;++r)p.push(h());if(r(p[0],t,o),r(p[0],p[0],f),r(p[0],p[0],d),m(p[1],t,o),r(p[1],p[1],f),r(p[1],p[1],d),r(p[2],t,o),m(p[2],p[2],f),r(p[2],p[2],d),m(p[3],t,o),m(p[3],p[3],f),r(p[3],p[3],d),r(p[4],t,o),r(p[4],p[4],f),m(p[4],p[4],d),m(p[5],t,o),r(p[5],p[5],f),m(p[5],p[5],d),r(p[6],t,o),m(p[6],p[6],f),m(p[6],p[6],d),m(p[7],t,o),m(p[7],p[7],f),m(p[7],p[7],d),b&&u(b,16)){const e=b;for(let t=0;t<8;++t)n(p[t],p[t],e)}const S=a(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),w=a(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let r=0;r<8;++r)E||g(p[r],l,0,p[r],x.WGS84,0),i(w,w,p[r]),s(S,S,p[r]);return new c({xmin:w[0],ymin:w[1],zmin:w[2],xmax:S[0],ymax:S[1],zmax:S[2],spatialReference:_})}return new c(-180,-90,180,90,_)}export{_ as getHeightModelInfoFromVCS,R as hasEsriCrs,E as initFullExtent,u as verifyArray};
