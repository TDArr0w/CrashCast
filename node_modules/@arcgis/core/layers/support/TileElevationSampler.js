/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as t}from"tslib";import e from"../../core/Logger.js";import{getMetersPerUnitForSR as o}from"../../core/unitUtils.js";import{property as n}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/RandomLCG.js";import{subclass as i}from"../../core/accessorSupport/decorators/subclass.js";import s from"../../geometry/SpatialReference.js";import{toExtent as r,create as l,containsXY as a}from"../../geometry/support/aaBoundingRect.js";import m from"./ElevationSampler.js";let p=class extends m{get spatialReference(){return this.extent.spatialReference}constructor(t){const e=t.noDataValue,o="tiles"in t?t.tiles.map(o=>new c({tile:o,tileInfo:t.tileInfo,noDataValue:e})):t.samplers;super({noDataValue:e,samplers:o});const n=o[0];if(n){this.extent=n.extent.clone();const{min:t,max:e}=n.demResolution;this.demResolution={min:t,max:e};for(let n=1;n<o.length;n++){const t=o[n];this.extent.union(t.extent),this.demResolution.min=Math.min(this.demResolution.min,t.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,t.demResolution.max)}}else{const e="tileInfo"in t?t.tileInfo:null;this.extent=r(l(),e?.spatialReference??s.WGS84),this.demResolution={min:0,max:0}}}elevationAt(t,o){let n;for(const e of this.samplers)if(e.containsAt(t,o)&&(n=e.elevationAt(t,o),n!==e.noDataValue))return n;return null!=n?n:(e.getLogger(this).warn("#elevationAt()",`Point used to sample elevation (${t}, ${o}) is outside of the sampler`),this.noDataValue)}};t([n({constructOnly:!0})],p.prototype,"noDataValue",void 0),t([n({constructOnly:!0})],p.prototype,"samplers",void 0),p=t([i("esri.layers.support.TileElevationSampler")],p);let c=class extends m{get spatialReference(){return this.extent.spatialReference}constructor(t){super(t);const e=t.tile.key.extent;this.extent=r(e,t.tileInfo.spatialReference),this.extent.zmin=t.tile.zmin,this.extent.zmax=t.tile.zmax;const n=o(t.tileInfo.spatialReference),i=t.tileInfo.lodAt(t.tile.key.level).resolution*n;this.demResolution={min:i,max:i}}contains(t){const e=this.projectIfRequired(t,this.spatialReference);return null!=e&&this.containsAt(e.x,e.y)}containsAt(t,e){return a(this.tile.key.extent,t,e)}elevationAt(t,e){return this.containsAt(t,e)?this.tile.sample(t,e)??this.noDataValue:this.noDataValue}};t([n({constructOnly:!0})],c.prototype,"tile",void 0),t([n({constructOnly:!0})],c.prototype,"noDataValue",void 0),t([n({constructOnly:!0})],c.prototype,"tileInfo",void 0),c=t([i("esri.layers.support.TileElevationSampler.SingleTileElevationSampler")],c);export{p as TileElevationSampler};
