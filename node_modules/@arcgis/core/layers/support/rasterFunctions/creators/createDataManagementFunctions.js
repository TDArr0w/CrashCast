/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{getNamedColor as t,hexToRgba as e}from"../../../../colorUtils.js";import{colormapName as n}from"../../rasterFunctionConstants.js";import{createRasterFunction as o}from"./utils.js";import{colorRampDict as r}from"../../../../renderers/support/colorRampUtils.js";function a(t){return"colormap"in t?s(t):"colorRamp"in t?i(t):u(t)}function s(n){const r=n.colormap.map(n=>{if("value"in n){const o="string"==typeof n.color?t(n.color)??e(n.color):n.color;(n=[n.value,...o])[4]&&n[4]<=1&&(n[4]=Math.round(255*n[4]))}return n}),{raster:a,outputPixelType:s}=n;return o("Colormap",{colormap:r,raster:a},s)}function i(t){const{raster:e,colorRamp:n,outputPixelType:r}=t,a={colorRamp:"toJSON"in n?n.toJSON():n,raster:e};return o("Colormap",a,r)}function u(t){const{colorRampName:e}=t,a=Object.values(n).find(t=>t.toLowerCase()===e?.toLowerCase()),s=r.toJSON(e),{raster:i,outputPixelType:u="unknown"}=t;return o("Colormap",a?{colormapName:a,raster:i}:{colorRampName:s,raster:i},u)}function l(t){const{raster:e,outputPixelType:n="u8"}=t;return o("ColormapToRGB",{raster:e},n)}function p(t){const{raster:e,histograms:n,outputPixelType:r}=t,a=t.statistics?.map(t=>({min:t.min,max:t.max,mean:t.avg,standardDeviation:t.stddev}));return o("StatisticsHistograms",{raster:e,statistics:a,histograms:n},r)}function c(t){const{raster:e,attributeTable:n,outputPixelType:r="unknown"}=t,a="toJSON"in n?n.toJSON():n;return o("Table",{raster:e,attributeTableAsRecordSet:a},r)}function m(t){const{raster:e,outputPixelType:n="unknown"}=t,r={raster:e,missingBandAction:"fail"===t.missingBandAction?1:0};return"bandIds"in t?r.bandIds=t.bandIds:"bandNames"in t?r.bandNames=t.bandNames:"bandWavelengths"in t&&(r.bandWavelengths=t.bandWavelengths),o("ExtractBand",r,n)}function d(t){const{redBand:e,greenBand:n,blueBand:r,raster:a,outputPixelType:s}=t,i="name"===t.method?0:2;return o("CreateColorComposite",{raster:a,method:i,bandIndexesR:e,bandIndexesG:n,bandIndexesB:r},s)}function f(t){const{rasters:e,outputPixelType:n}=t;return o("CompositeBand",{rasters:e},n)}function g(t){const{allowUnmatched:e,raster:n,rangeMaps:r,outputPixelType:a,replacementValue:s}=t,i=r?.filter(({output:t})=>null!=t),u=i?.flatMap(({range:t})=>t),l=i?.map(({output:t})=>t),p=r?.filter(t=>null==t.output)?.flatMap(({range:t})=>t);return o("Remap",{allowUnmatched:e,raster:n,inputRanges:u,outputValues:l,noDataRanges:p,replacementValue:s},a)}function b(t){const{inputBitPositions:e,raster:n,fillRaster:r,outputBitPositions:a,outputPixelType:s}=t,i={inputBitPositions:e,outputBitPositions:a,raster:n};return null!=r&&("number"==typeof r?(i.constantFillCheck=!0,i.constantFillValue=r):i.fillRaster=r),o("TransposeBits",i,s)}function x(t){const{raster:e,outputPixelType:n="unknown"}=t,r=t.includedRanges?.flat(),a=t.noDataValues?.map(t=>t.join(" ")),s="match-all"===t.noDataInterpretation?1:0;return o("Mask",{raster:e,includedRanges:r,noDataInterpretation:s,noDataValues:a},n)}function T(t){const{geometry:e,keepOutside:n,outputPixelType:r="unknown",raster:a}=t,s="declaredClass"in e?e.toJSON():e;return o("Clip",{clippingGeometry:s,clippingType:n?2:1,raster:a},r)}export{T as clip,a as colormap,l as colormapToRGB,f as compositeBand,d as createColorComposite,m as extractBand,x as mask,g as remap,p as statisticsHistogram,c as table,b as transposeBits};
