/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import{getKey as t}from"../../../core/object.js";import i from"../../../geometry/SpatialReference.js";import r from"../DataModel.js";import n from"../EntityType.js";import o from"../FieldIndex.js";import a from"../GraphObjectType.js";import s from"../GraphProperty.js";import p from"../RelationshipType.js";import l from"../SearchIndex.js";import d from"../SourceTypeValueBehavior.js";import{EsriUuidMethodHintTypes as f,EsriIdentifierInfoType as u,EsriNamedTypeCategory as c,NamedObjectTypes as m,EsriGraphPropertyRole as y,EsriGeometryTypes as _,EsriFieldTypes as g}from"./WasmDataModelWrapperInterfaces.js";let h=!1;function v(n){n.deleteLater(),h=!1;const o=new r({timestamp:n.timestamp,spatialReference:new i(n.spatial_reference),strict:n.strict,objectIdField:n.objectid_property,globalIdField:n.globalid_property,arcgisManaged:n.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:t(u,n.identifier_info?.identifier_mapping_info?.identifier_info_type?.value),databaseNativeIdentifier:n.identifier_info?.identifier_mapping_info?.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:n.identifier_info?.identifier_mapping_info?.uniform_property_identifier?.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:t(f,n.identifier_info?.identifier_generation_info?.uuid_method_hint?.value)}},searchIndexes:k(n.search_indexes),entityTypes:x(n.entity_types),relationshipTypes:G(n.relationship_types),metaEntityTypes:x(n.meta_entity_types),provenanceSourceTypeValues:S(n.provenance_source_type_values.value_behavior_array)});return h&&e.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("A big integer field was detected in the retrieved data model.  The `big-integer` field type is not fully supported in web clients.  Please see https://developers.arcgis.com/javascript/latest/api-reference/esri-layers-support-Field.html#type"),o}function b(e){return e.deleteLater(),new n(T(e))}function j(e){return e.deleteLater(),new o({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:M(e.fields)})}function z(e){return e.deleteLater(),new a(T(e))}function T(e){return{name:e.name,alias:e.alias,role:t(m,e.role.value),strict:e.strict,properties:P(e.properties),fieldIndexes:F(e.field_indexes)}}function w(e){return e.deleteLater(),new s({alias:e.alias,name:e.name,fieldType:t(g,e.field_type.value)??void 0,geometryType:t(_,e.geometry_type.value)??null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:t(y,e.role.value),defaultValue:e.default_value})}function I(e){e.deleteLater();const t=T(e),i=[];for(let r=0;r<e.end_points.size();r++){const t=e.end_points.get(r);i.push({originEntityType:t.origin_entity_type,destinationEntityType:t.dest_entity_type})}return e.end_points.delete(),new p(Object.assign({endPoints:i},t))}function L(e){return new d({behavior:e.behavior,value:e.value})}function x(e){const t=[];for(let i=0;i<e.size();i++)t.push(b(e.get(i)));return e.delete(),t}function M(e){const t=[];for(let i=0;i<e.size();i++)t.push(e.get(i));return e.delete(),t}function P(e){const t=[];for(let i=0;i<e.size();i++){const r=w(e.get(i));"esriFieldTypeBigInteger"===r.fieldType&&(h=!0),t.push(r)}return e.delete(),t}function F(e){const t=[];for(let i=0;i<e.size();i++)t.push(j(e.get(i)));return e.delete(),t}function G(e){const t=[];for(let i=0;i<e.size();i++)t.push(I(e.get(i)));return e.delete(),t}function S(e){const t=[];for(let i=0;i<e.size();i++){const r=e.get(i);r.deleteLater(),t.push(L(r))}return e.delete(),t}function k(e){const i=[];for(let r=0;r<e.size();r++){const n=new l,o=e.get(r);n.name=o.name,n.supportedCategory=t(c,o.supported_category.value);const a=o.analyzers.size();for(let e=0;e<a;e++)n.analyzers.push({name:o.analyzers.get(e).name});o.analyzers.delete();for(let e=0;e<o.search_properties.keys().size();e++){const t=o.search_properties.keys().get(e),i=o.search_properties.get(t),r=[];for(let e=0;e<i.property_names.size();e++)r.push(i.property_names.get(e));n.searchProperties.set(t,{propertyNames:r})}i.push(n)}return e.delete(),i}export{v as wasmToDataModel,b as wasmToEntityType,j as wasmToFieldIndex,z as wasmToGraphObjectType,w as wasmToGraphProperty,I as wasmToRelationshipType,L as wasmToSourceTypeValueBehavior};
