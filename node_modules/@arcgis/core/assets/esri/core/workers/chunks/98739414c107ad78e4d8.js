"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[9926],{18047:(e,t,n)=>{n.d(t,{Up:()=>u,ZV:()=>s,yx:()=>l});var r=n(73444);const i={ar:"ar-u-nu-latn",bs:"sr-Latn-CS",nn:"no-NN"};let a=new WeakMap,o={};function l(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t}function u(e){const{minimumFractionDigits:t,maximumFractionDigits:n,useGrouping:r}=e;return{minimumFractionDigits:t,maximumFractionDigits:n,useGrouping:"auto"===r?"auto":"always"===r}}function s(e,t){return Object.is(e,-0)&&(e=0),function(e){const t=e||o;if(!a.has(t)){const n=(0,r.lR)(),o=n&&i[n]||(0,r.QC)();a.set(t,new Intl.NumberFormat(o,e))}return a.get(t)}(t).format(e)}(0,r.Ml)(()=>{a=new WeakMap,o={}}),new Map},29926:(e,t,n)=>{n.r(t),n.d(t,{applyTextFormattingHTML:()=>K,createFieldInfoMap:()=>_,findRelatedLayer:()=>se,findUtilityNetwork:()=>fe,fixTokens:()=>S,formatAttributes:()=>ee,formatEditInfo:()=>W,formatValueToFieldInfo:()=>V,getAllFieldInfos:()=>Y,getFieldFormat:()=>q,getFieldInfo:()=>P,getFieldInfoLabel:()=>v,getFixedFieldName:()=>R,getFixedFieldNames:()=>E,getSourceLayer:()=>L,graphicCallback:()=>x,htmlEntities:()=>B,isAssociatedFeatureSupportedLayer:()=>H,isExpressionField:()=>A,isFeatureSupportedLayer:()=>G,isGraphicForRelatableFeatureSupportedLayer:()=>Q,isRelatableFeatureSupportedLayer:()=>z,isRelatableLayer:()=>O,isRelatedField:()=>re,isSupportedContext:()=>Z,preLayerQueryCallback:()=>le,preRequestCallback:()=>ue,querySourceLayer:()=>te,queryUpdatedFeature:()=>ne,shouldOpenInNewTab:()=>k,substituteAttributes:()=>D,substituteFieldsInLinksAndAttributes:()=>U});var r=n(44208),i=n(53966),a=n(799),o=n(97770),l=n(18047),u=n(39663),s=n(30524),f=n(77548),d=n(4560),c=n(43668),p=n(56400);const y=()=>i.A.getLogger("esri.widgets.Feature.support.featureUtils"),m=/href=(""|'')/gi,g=/(\{([^{\r\n]+)\})/g,b=/'/g,I=/^\s*expression\//i,F=/(\n)/gi,h=/[\u00A0-\u9999<>&]/gim,w=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,T=/^(?:mailto:|tel:)/,N="relationships/",C=(0,o.J2)("short-date-short-time");function L(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0}async function x({type:e,value:t,event:n}){try{return"function"==typeof t?t(n):await t}catch(r){return void y().error("error",`An error occurred when calling the "${e}" function`,{error:r,graphic:n.graphic,value:t})}}function k(e=""){if(e)return!T.test(e.trim().toLowerCase())}function A(e){return!!e&&I.test(e)}function Z({fieldInfo:e,graphic:t}){return!(!e?.fieldName||A(e.fieldName)||re(e.fieldName)||t?.isAggregate||t?.popupTemplate)}function v({expressionInfos:e,fieldInfo:t,graphic:n,isContentFieldInfos:r,layer:i}){if(!t?.fieldName)return null;const a=function(e,t){if(!t||!A(t)||!e)return;const n=t.replace(I,"").toLowerCase();return e.find(({name:e})=>e.toLowerCase()===n)}(e,t.fieldName);if(a)return a.title||null;if((0,f.jy)(i)&&Z({fieldInfo:t,graphic:n})){const e=i.getFieldAlias(t.fieldName);return r?t.label||e||t.fieldName:e||t.fieldName}return t.label||t.fieldName}function q({fieldInfo:e,isContentFieldInfos:t,layer:n}){if(!e?.fieldName)return null;if((0,f.jy)(n)){const r=n.popupTemplate||n.fieldConfigurations?n.getFieldConfiguration(e.fieldName)?.fieldFormat:(0,u.iu)(e,n.getField(e.fieldName));return t&&e.fieldFormat||r}return null}function R(e,t){const n=M(t,e);return n?n.name:e}function E(e,t){return e&&e.map(e=>R(e,t))}function M(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function j(e){return`${e}`.trim()}function U({attributes:e,globalAttributes:t,layer:n,text:r,expressionAttributes:i,fieldInfoMap:a}){return r?D({formattedAttributes:t,template:$(r,{...t,...i,...e},n),fieldInfoMap:a}):""}function D({formattedAttributes:e,template:t,fieldInfoMap:n}){return j(function(e){return e.replaceAll(m,"")}((0,a.HC)((0,a.HC)(t,e=>function(e,t){const n=t.get(e.toLowerCase());return`{${n?.fieldName||e}}`}(e,n)),e)))}function S(e,t){return e.replaceAll(g,(e,n,r)=>{const i=M(t,r);return i?`{${i.name}}`:n})}function $(e,t,n){const r=S(e,n);return r?r.replaceAll(w,(e,n,r)=>function(e,t,n){const r=(t=j(t))&&!t.startsWith("{");return(0,a.HC)(e,function(e,t=!1){const n={...e};return Object.keys(n).forEach(e=>function(e,t,n=!1){const r=t[e];if("string"==typeof r){const i="%27",a=(n?encodeURIComponent(r):r).replaceAll(b,i);t[e]=a}}(e,n,t)),n}(n,r||!1))}(e,n||r,t)):r}function G(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function O(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function z(e){return G(e)&&O(e)}function H(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)}function Q(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&z(e.sourceLayer)}function V(e,t){const{fieldInfos:n,fieldName:r,graphic:i,isContentFieldInfos:a,layer:o,preventPlacesFormatting:u,timeZone:c}=t,p=P(n,r),y=M(o,r),m=(0,f.jy)(o)&&Z({fieldInfo:p,graphic:i}),g=m?null:p?.format,b=m?q({fieldInfo:p,layer:o,isContentFieldInfos:a}):null,I="number"===b?.type;if(p&&!(0,s.JL)(r)){const t=y?.type,n="date-time"===b?.type,r=g?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||n||r)return(0,d.i0)(e,{format:n?void 0:r,fieldFormat:n?b:void 0,fieldType:t,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:c,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o)||!o.datesInUnknownTimezone)}})}if("string"==typeof e&&(0,s.JL)(r)&&g)return function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?J(e,",",", ",t):e.includes(";")?J(e,";","; ",t):e.includes(" ")?J(e," "," ",t):(0,l.ZV)(Number(e),(0,l.yx)(t))}(e,g);if("string"==typeof(e=function(e,t){const n="number"===t?.fieldFormat?.type||t?.format&&null==t.format.dateFormat&&(null!=t.format.places||null!=t.format.digitSeparator);if("string"==typeof e&&n){const t=Number(e);if(!isNaN(t))return t}return e}(e,{format:I?void 0:g,fieldFormat:I?b:void 0}))||null==e||null==g&&null==b)return K(e);const F=I?(0,l.Up)(b):g?(0,l.yx)(g):void 0;return(0,l.ZV)(e,u?{...F,minimumFractionDigits:0,maximumFractionDigits:20}:F)}function J(e,t,n,r){return e.trim().split(t).map(e=>(0,l.ZV)(Number(e),(0,l.yx)(r))).join(n)}function P(e,t){if(e?.length&&t)return e.find(e=>e.fieldName?.toLowerCase()===t.toLowerCase())}function W(e,t,n,r){const{creatorField:i,creationDateField:a,editorField:l,editDateField:u}=e;if(!t)return;const s=(0,p.hv)(r&&"preferredTimeZone"in r?r.preferredTimeZone:null,!(!r||!("datesInUnknownTimezone"in r)||!r.datesInUnknownTimezone),n,C,"date"),f={...C,...s},d=t[u];if("number"==typeof d){const e=t[l];return{type:"edit",date:(0,o.Yq)(d,f),user:e}}const c=t[a];if("number"==typeof c){const e=t[i];return{type:"create",date:(0,o.Yq)(c,f),user:e}}return null}function _(e,t){const n=new Map;if(!e)return n;for(const r of e){if(!r.fieldName)continue;const e=R(r.fieldName,t);r.fieldName=e,n.set(e.toLowerCase(),r)}return n}function Y(e){const t=[];if(!e)return t;const{fieldInfos:n,content:r}=e;return n&&t.push(...n),r&&Array.isArray(r)?(r.forEach(e=>{if("fields"===e.type){const n=e?.fieldInfos;n&&t.push(...n)}}),t):t}function B(e){return e.replaceAll(h,e=>`&#${e.charCodeAt(0)};`)}function K(e){return"string"==typeof e?e.replaceAll(F,'<br class="esri-text-new-line" />'):e}function X(e){const{fieldInfoMap:t,fieldInfos:n,fieldName:i,graphic:a,isContentFieldInfos:o,layer:l,timeZone:u,value:f}=e;if(null==f)return"";const c=function({fieldName:e,value:t,graphic:n,layer:i}){if(re(e))return null;if(!i||"function"!=typeof i.getFieldDomain)return null;const a=n&&i.getFieldDomain(e,{feature:n,excludeImpliedDomains:(0,r.A)("esri-widget-legacy-field-domain-calculation")});return a&&"coded-value"===a.type?a.getName(t):null}({fieldName:i,value:f,graphic:a,layer:l});if(c)return c;const p=function({fieldName:e,graphic:t,layer:n}){if(re(e))return null;if(!n||"function"!=typeof n.getFeatureType)return null;const{typeIdField:r}=n;if(!r||e!==r)return null;const i=n.getFeatureType(t);return i?i.name:null}({fieldName:i,graphic:a,layer:l});if(p)return p;if(t.get(i.toLowerCase()))return V(f,{fieldInfos:n||Array.from(t.values()),fieldName:i,graphic:a,isContentFieldInfos:o,layer:l,timeZone:u});const y=l?.fieldsIndex?.get(i);return y&&((0,d.fs)(y)||(0,s.OH)(y))?(0,d.i0)(f,{fieldType:y.type,timeZoneOptions:{layerTimeZone:l&&"preferredTimeZone"in l?l.preferredTimeZone:null,viewTimeZone:u,datesInUnknownTimezone:!(!l||!("datesInUnknownTimezone"in l)||!l.datesInUnknownTimezone)}}):K(f)}function ee({attributes:e,fieldInfoMap:t,fieldInfos:n,graphic:r,isContentFieldInfos:i,layer:a,relatedInfos:o,timeZone:l}){const u={};return o?.forEach(e=>function({attributes:e,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:i,timeZone:a}){e&&t&&(t.relatedFeatures?.forEach(o=>ie({attributes:e,graphic:o,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:i,timeZone:a})),t.relatedStatsFeatures?.forEach(o=>ie({attributes:e,graphic:o,relatedInfo:t,fieldInfoMap:n,fieldInfos:r,layer:i,timeZone:a})))}({attributes:u,relatedInfo:e,fieldInfoMap:t,fieldInfos:n,layer:a,timeZone:l})),e&&Object.keys(e).forEach(o=>{const s=e[o];u[o]=X({fieldInfoMap:t,fieldInfos:n,fieldName:o,graphic:r,isContentFieldInfos:i,layer:a,timeZone:l,value:s})}),u}async function te(e,t){const{layer:n,graphic:r,outFields:i,objectIds:a,returnGeometry:o,spatialReference:l}=e,u=a[0];if("number"!=typeof u&&"string"!=typeof u){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:n,graphic:r,objectId:u,requiredFields:i};return y().warn(e,t),null}if(!(0,f.BR)(n)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:n,graphic:r,requiredFields:i,returnGeometry:o};return y().warn(e,t),null}const s=n.createQuery();return s.objectIds=a,s.outFields=i?.length?i:[n.objectIdField],s.returnGeometry=!!o,s.returnZ=!!o,s.returnM=!!o,s.outSpatialReference=l,(await n.queryFeatures(s,t)).features[0]}async function ne({graphic:e,popupTemplate:t,layer:n,spatialReference:r},i){if(!n||!t)return;if("function"==typeof n.load&&await n.load(i),!e.attributes)return;const a=n.objectIdField,o=e.attributes[a];if(null==o)return;const l=[o],u=new Set(await t.getRequiredFields(n.fieldsIndex));null==n.timeInfo?.trackIdField||u.has(n.timeInfo.trackIdField)||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.l)(),{arcadeUtils:{requiresTrack:n}}=t;return n(e)}(t)&&u.add(n.timeInfo.trackIdField);const f=(0,s.Kl)(e,u),d=f?[]:u.has(a)?[...u]:[...u,a],p=t.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await(0,c.l)(),{arcadeUtils:{hasGeometryFunctions:n}}=t;return n(e)}(t);if(f&&!p)return;const y=await te({layer:n,graphic:e,outFields:d,objectIds:l,returnGeometry:p,spatialReference:r},i);y&&(y.geometry&&(e.geometry=y.geometry),y.attributes&&(e.attributes={...e.attributes,...y.attributes}))}function re(e=""){return!!e&&e.includes(N)}function ie({attributes:e,graphic:t,relatedInfo:n,fieldInfos:r,fieldInfoMap:i,layer:a,timeZone:o}){e&&t&&n&&Object.keys(t.attributes).forEach(l=>{const u=function(e){return e?`${N}${e.layerId}/${e.fieldName}`:""}({layerId:n.relation.id.toString(),fieldName:l}),s=t.attributes[l];e[u]=X({fieldName:u,fieldInfos:r,fieldInfoMap:i,layer:a,value:s,graphic:t,timeZone:o})})}const ae=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},oe=({layer:e,method:t,query:n,definitionExpression:r})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;const i=null!=n.where?n.where:null,a=null!=n.geometry?n.geometry:null;ae(r)||ae(i)||"extent"===a?.type||"tile"===n.resultType||(n.cacheHint=!0)},le=({query:e,layer:t,method:n})=>{oe({layer:t,method:n,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},ue=({queryPayload:e,layer:t,method:n})=>{oe({layer:t,method:n,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})};function se(e,t,n){return e&&t&&n?"sublayer"===t.type?ce({layers:t.layer?.allSublayers,map:e,relatedLayer:t,relationship:n})||ce({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:n}):ce({layers:e.allLayers,map:e,relatedLayer:t,relationship:n})||ce({layers:e.allTables,map:e,relatedLayer:t,relationship:n}):null}function fe(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find(e=>e.isUtilityLayer(t)):null}function de(e,t){return e?.allTables.find(e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url)}function ce({map:e,relationship:t,relationship:{relatedTableId:n},relatedLayer:r,layers:i}){if(!i)return null;for(const a of i){if("map-image"===a.type){const n=ce({layers:a.sublayers,map:e,relatedLayer:r,relationship:t})||ce({layers:a.subtables,map:e,relatedLayer:r,relationship:t});if(n)return n;continue}if(!z(a))continue;if("sublayer"===r.type){if(a!==r&&a.id===n)return a.isTable?de(e,a):a;continue}const i="scene"===r.type&&r.associatedLayer?r.associatedLayer.url:r.url;if(!i)return null;if("sublayer"!==a.type){if(a!==r&&a.url===i&&a.layerId===n)return a}else if(a!==r&&a.layer?.url===i&&a.id===n)return a.isTable?de(e,a):a}return null}}}]);