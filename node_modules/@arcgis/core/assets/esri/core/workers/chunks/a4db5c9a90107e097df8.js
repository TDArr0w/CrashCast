"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[957],{8303:(t,e,s)=>{s.d(e,{A:()=>S});var r=s(31635),o=s(92602),i=s(70333),n=s(78888),u=s(60999),a=s(49186),p=s(53966),l=s(97768),c=s(74887),d=s(84952),y=s(10107),g=(s(44208),s(87811),s(36005)),f=s(64108),m=s(43937),h=s(77548),v=s(20655),C=s(80812),A=s(41318),I=s(10407);const S=t=>{const e=t;let S=class extends e{constructor(){super(...arguments),this.resourceReferences={portalItem:null,paths:[]},this.userHasEditingPrivileges=!0,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1}destroy(){this.portalItem=(0,l.pR)(this.portalItem),this.resourceReferences.portalItem=null,this.resourceReferences.paths.length=0}set portalItem(t){t!==this._get("portalItem")&&(this.removeOrigin("portal-item"),this._set("portalItem",t))}readPortalItem(t,e,s){if(e.itemId)return new C.default({id:e.itemId,portal:s?.portal})}writePortalItem(t,e){t?.id&&(e.itemId=t.id)}async loadFromPortal(t,e){if(this.portalItem?.id)try{const{load:r}=await s.e(1204).then(s.bind(s,41204));return(0,c.Te)(e),await r({instance:this,supportedTypes:t.supportedTypes,validateItem:t.validateItem,supportsData:t.supportsData,layerModuleTypeMap:t.layerModuleTypeMap,populateGroupLayer:t.populateGroupLayer},e)}catch(t){throw(0,c.zf)(t)||p.A.getLogger(this).warn(`Failed to load layer (${this.title}, ${this.id}) portal item (${this.portalItem.id})\n  ${t}`),t}}async finishLoadEditablePortalLayer(t){this._set("userHasEditingPrivileges",await this._fetchUserHasEditingPrivileges(t).catch(t=>((0,c.QP)(t),!0)))}async setUserPrivileges(t,e){if(!o.A.userPrivilegesApplied)return this.finishLoadEditablePortalLayer(e);if(this.url)try{const{features:{edit:s,fullEdit:r},content:{updateItem:o}}=await this._fetchUserPrivileges(t,e);this._set("userHasEditingPrivileges",s),this._set("userHasFullEditingPrivileges",r),this._set("userHasUpdateItemPrivileges",o)}catch(t){(0,c.QP)(t)}}async _fetchUserPrivileges(t,e){let s=this.portalItem;if(!t||!s||!s.loaded||s.sourceUrl)return this._fetchFallbackUserPrivileges(e);const r=!i.id?.findCredential(this.url),o=t===s.id;if(o&&s.portal.user)return this._getUserPrivileges(s,r);let n,u;if(o)n=s.portal.url;else try{n=await(0,h.wI)(this.url,e)}catch(t){(0,c.QP)(t)}if(!n||!(0,d.b8)(n,s.portal.url))return this._fetchFallbackUserPrivileges(e);try{const t=null!=e?e.signal:null;u=await(i.id?.getCredential(`${n}/sharing`,{prompt:!1,signal:t}))}catch(t){(0,c.QP)(t)}const a=!0,p=!1,l=!1;if(!u)return{features:{edit:a,fullEdit:p},content:{updateItem:l}};try{if(o?await s.reload():(s=new C.default({id:t,portal:{url:n}}),await s.load(e)),s.portal.user)return this._getUserPrivileges(s,r)}catch(t){(0,c.QP)(t)}return{features:{edit:a,fullEdit:p},content:{updateItem:l}}}_getUserPrivileges(t,e){const s=(0,I.It)(t);return e&&(s.features.edit=!0),s}async _fetchFallbackUserPrivileges(t){let e=!0;try{e=await this._fetchUserHasEditingPrivileges(t)}catch(t){(0,c.QP)(t)}return{features:{edit:e,fullEdit:!1},content:{updateItem:!1}}}async _fetchUserHasEditingPrivileges(t){const e=this.url?i.id?.findCredential(this.url):null;if(!e)return!0;const s=P.credential===e?P.user:await this._fetchEditingUser(t);return P.credential=e,P.user=s,null==s?.privileges||s.privileges.includes("features:user:edit")}async _fetchEditingUser(t){const e=this.portalItem?.portal?.user;if(e)return e;const s=i.id?.findServerInfo(this.url??"");if(!s?.owningSystemUrl)return null;const r=`${s.owningSystemUrl}/sharing/rest`,o=v.A.getDefault();if(o&&o.loaded&&(0,d.S8)(o.restUrl)===(0,d.S8)(r))return o.user;const a=`${r}/community/self`,p=null!=t?t.signal:null,l=await(0,u.Ke)((0,n.A)(a,{authMode:"no-prompt",query:{f:"json"},signal:p}));return l.ok?A.A.fromJSON(l.value.data):null}read(t,e){e&&(e.layer=this),super.read(t,e)}write(t,e){const s=e?.portal,r=this.portalItem?.id&&(this.portalItem.portal||v.A.getDefault());return s&&r&&!(0,d.ut)(r.restUrl,s.restUrl)?(e.messages&&e.messages.push(new a.A("layer:cross-portal",`The layer '${this.title} (${this.id})' cannot be persisted because it refers to an item on a different portal than the one being saved to. To save, set layer.portalItem to null or save to the same portal as the item associated with the layer`,{layer:this})),null):super.write(t,{...e,layer:this})}};return(0,r.Cg)([(0,y.MZ)({type:C.default})],S.prototype,"portalItem",null),(0,r.Cg)([(0,g.w)("web-document","portalItem",["itemId"])],S.prototype,"readPortalItem",null),(0,r.Cg)([(0,m.K)("web-document","portalItem",{itemId:{type:String}})],S.prototype,"writePortalItem",null),(0,r.Cg)([(0,y.MZ)({clonable:!1})],S.prototype,"resourceReferences",void 0),(0,r.Cg)([(0,y.MZ)({type:Boolean,readOnly:!0})],S.prototype,"userHasEditingPrivileges",void 0),(0,r.Cg)([(0,y.MZ)({type:Boolean,readOnly:!0})],S.prototype,"userHasFullEditingPrivileges",void 0),(0,r.Cg)([(0,y.MZ)({type:Boolean,readOnly:!0})],S.prototype,"userHasUpdateItemPrivileges",void 0),S=(0,r.Cg)([(0,f.$)("esri.layers.mixins.PortalLayer")],S),S},P={credential:null,user:null}},10407:(t,e,s)=>{s.d(e,{It:()=>y,LG:()=>n,OM:()=>p,Sm:()=>l,Y:()=>u,bK:()=>a,mm:()=>d,sQ:()=>c});var r=s(91218),o=s(16930),i=s(28735);function n(t,e){if(!u(t,e)){const s=t.typeKeywords;s?s.push(e):t.typeKeywords=[e]}}function u(t,e){return!!t.typeKeywords?.includes(e)}function a(t){return u(t,d.HOSTED_SERVICE)}function p(t,e){const s=t.typeKeywords;if(s){const t=s.indexOf(e);t>-1&&s.splice(t,1)}}function l(t,e,s){s?n(t,e):p(t,e)}async function c(t){const e=t.clone().normalize();let s;if(e.length>1)for(const t of e)s?t.width>s.width&&(s=t):s=t;else s=e[0];return async function(t){const e=t.spatialReference;if(e.isWGS84)return t.clone();if(e.isWebMercator)return(0,i.ci)(t);const s=o.A.WGS84;return await(0,r.initializeProjection)(e,s),(0,r.project)(t,s)}(s)}const d={CHARTS:"Charts",DYNAMIC:"Dynamic",DEVELOPER_BASEMAP:"DeveloperBasemap",GROUP_LAYER_MAP:"Map",HOSTED_SERVICE:"Hosted Service",JSAPI:"ArcGIS API for JavaScript",LOCAL_SCENE:"ViewingMode-Local",METADATA:"Metadata",MULTI_LAYER:"Multilayer",ORIENTED_IMAGERY_LAYER:"OrientedImageryLayer",SINGLE_LAYER:"Singlelayer",SUBTYPE_GROUP_LAYER:"SubtypeGroupLayer",SUBTYPE_GROUP_TABLE:"SubtypeGroupTable",TABLE:"Table",TILED_IMAGERY:"Tiled Imagery"};function y(t){const{portal:e,isOrgItem:s,itemControl:r}=t,o=e.user?.privileges;let i=!o||o.includes("features:user:edit"),n=!!s&&!!o?.includes("features:user:fullEdit");const u="update"===r||"admin"===r;return u?n=i=!0:n&&(i=!0),{features:{edit:i,fullEdit:n},content:{updateItem:u}}}},18768:(t,e,s)=>{s.d(e,{b:()=>a});var r=s(31635),o=s(53966),i=s(10107),n=(s(44208),s(87811),s(64108)),u=s(60694);const a=t=>{const e=t;let s=class extends e{get title(){if(this._get("title")&&"defaults"!==this.originOf("title"))return this._get("title");if(this.url){const t=(0,u.qg)(this.url);if(t?.title)return t.title}return this._get("title")||""}set title(t){this._set("title",t)}set url(t){this._set("url",(0,u.Jf)(t,o.A.getLogger(this)))}};return(0,r.Cg)([(0,i.MZ)()],s.prototype,"title",null),(0,r.Cg)([(0,i.MZ)({type:String})],s.prototype,"url",null),s=(0,r.Cg)([(0,n.$)("esri.layers.mixins.ArcGISService")],s),s}},20557:(t,e,s)=>{s.d(e,{Fm:()=>a,Hz:()=>y,JQ:()=>d,JZ:()=>A,ND:()=>f,R_:()=>n,U9:()=>c,fu:()=>o,nr:()=>g,oF:()=>i,rq:()=>p,z$:()=>l});const r=[["binary","application/octet-stream","bin",""]];function o(t,e){return null!=h(e.name,t?.supportedFormats??[])}function i(t,e){if(!t)return!1;const s=p(e,t.supportedFormats??[]);return null!=s&&t.editFormats.includes(s)}function n(t,e){return v(function(t,e){const s=t.toLowerCase();return m(e).find(t=>C(t)===s)}(t,e))}function u(t,e){return v(h(t,e))}function a(t,e){return C(function(t,e){return m(e).find(e=>v(e)===t)}(t,e))}function p(t,e){return u(t.name,e)??n(t.type,e)}function l(t,e,s){return n(t,s)??u(e,s)}function c({supportedFormats:t}){return l("model/gltf-binary","glb",t)}function d(t){const e=c(t);return null!=e&&t.editFormats.includes(e)}function y(t){if(!t)return null;const e=c(t),s=function({supportedFormats:t}){return l("model/gltf+json","gltf",t)}(t);let r=null;for(const o of t.queryFormats){if(o===e)return o;o===s&&(r=o)}return r}function g({supportedFormats:t}){return l("application/esri3do-SR_world","wld",t)}function f({supportedFormats:t}){return l("application/esri3do-SR_prj","prj",t)}function m(t){return[...r,...t]}function h(t,e){const s=t.toLowerCase();return m(e).find(t=>function(t){return t?.[2].split(",").map(t=>t.toLowerCase())??[]}(t).some(t=>s.endsWith(t)))}function v(t){return t?.[0]}function C(t){return t?.[1].toLowerCase()}function A(t){return t.tables?.find(t=>"assetMaps"===t.role)}},22453:(t,e,s)=>{s.d(e,{S:()=>g,d:()=>w});var r=s(44208),o=s(60694),i=s(20557);function n(t,e,s){return!!a(t,e,s)}function u(t,e,s){return a(t,e,s)}function a(t,e,s){return t&&t.hasOwnProperty(e)?t[e]:s}const p={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function l(t){const e=t?.supportedSpatialAggregationStatistics?.map(t=>t.toLowerCase());return{envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function c(t,e){const s=t?.supportedOperationsWithCacheHint?.map(t=>t.toLowerCase());return!!s?.includes(e.toLowerCase())}function d(t){const e=t?.supportedStatisticTypes?.map(t=>t.toLowerCase());return{count:!!e?.includes("count"),sum:!!e?.includes("sum"),min:!!e?.includes("min"),max:!!e?.includes("max"),avg:!!e?.includes("avg"),var:!!e?.includes("var"),stddev:!!e?.includes("stddev"),percentileContinuous:!!e?.includes("percentile_cont"),percentileDiscrete:!!e?.includes("percentile_disc"),envelope:!!e?.includes("envelopeaggregate"),centroid:!!e?.includes("centroidaggregate"),convexHull:!!e?.includes("convexhullaggregate")}}function y(t){const e=t?.supportedNormalizationTypes?.map(t=>t.toLowerCase());return{field:!!e?.includes("field"),log:!!e?.includes("log"),naturalLog:!!e?.includes("naturallog"),percentOfTotal:!!e?.includes("percentoftotal"),squareRoot:!!e?.includes("squareroot")}}function g(t,e){return{analytics:f(t),attachment:m(t),data:h(t),metadata:v(t),operations:C(t.capabilities,t,e),query:A(t,e),queryAttributeBins:P(t),queryRelated:I(t),queryTopFeatures:S(t),editing:E(t)}}function f(t){return{supportsCacheHint:c(t.advancedQueryCapabilities,"queryAnalytics")}}function m(t){const e=t.attachmentProperties,s={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:c(t.advancedQueryCapabilities,"queryAttachments"),supportsOrderByFields:n(t.advancedQueryCapabilities,"supportsQueryAttachmentOrderByFields",!1),supportsResize:n(t,"supportsAttachmentsResizing",!1),supportsTypeWildcard:n(t.advancedQueryCapabilities,"supportsQueryAttachmentWithTypeWildcard",!1)};return e&&Array.isArray(e)&&e.forEach(t=>{const e=p[t.name];e&&(s[e]=!!t.isEnabled)}),s}function h(t){return{isVersioned:n(t,"isDataVersioned",!1),isBranchVersioned:n(t,"isDataBranchVersioned",!1),supportsAttachment:n(t,"hasAttachments",!1),supportsM:n(t,"hasM",!1),supportsZ:n(t,"hasZ",!1)}}function v(t){return{supportsAdvancedFieldProperties:n(t,"supportsFieldDescriptionProperty",!1)}}function C(t,e,s){const r=t?.toLowerCase().split(",").map(t=>t.trim())??[],i=s?(0,o.qg)(s):null,u=r.includes("MapServer"===i?.serverType?"data":"query"),a=r.includes("editing")&&!e.datesInUnknownTimezone&&!(!0===e.uniqueIdInfo?.OIDFieldContainsHashValue);let p=a&&r.includes("create"),l=a&&r.includes("delete"),c=a&&r.includes("update");const d=r.includes("changetracking"),y=e.advancedQueryCapabilities;return a&&!(p||l||c)&&(p=l=c=!0),{supportsCalculate:n(e,"supportsCalculate",!1),supportsTruncate:n(e,"supportsTruncate",!1),supportsValidateSql:n(e,"supportsValidateSql",!1),supportsAdd:p,supportsDelete:l,supportsEditing:a,supportsChangeTracking:d,supportsQuery:u,supportsQueryAnalytics:n(y,"supportsQueryAnalytic",!1),supportsQueryAttachments:n(y,"supportsQueryAttachments",!1),supportsQueryBins:n(y,"supportsQueryBins",!1)||!!e.queryBinsCapabilities,supportsQueryPivot:n(y,"supportsQueryPivot",!1),supportsQueryTopFeatures:n(y,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:n(e,"supportsAttachmentsResizing",!1),supportsSync:r.includes("sync"),supportsUpdate:c,supportsExceedsLimitStatistics:n(e,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:n(e,"supportsAsyncConvert3D",!1)}}function A(t,e){const s=t.advancedQueryCapabilities,a=t.ownershipBasedAccessControlForFeatures,p=t.archivingInfo,d=t.currentVersion,y=e?.includes("MapServer"),g=!y||d>=(0,r.A)("mapserver-pbf-version-support"),f=(0,o.Wo)(e),m=new Set((t.supportedQueryFormats??"").split(",").map(t=>t.toLowerCase().trim()));return{maxRecordCount:u(t,"maxRecordCount",void 0),maxRecordCountFactor:u(t,"maxRecordCountFactor",void 0),maxUniqueIDCount:u(t,"maxUniqueIDCount",void 0),standardMaxRecordCount:u(t,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:l(s),supportsCacheHint:n(s,"supportsQueryWithCacheHint",!1)||c(s,"query"),supportsCentroid:n(s,"supportsReturningGeometryCentroid",!1),supportsCentroidOnDegeneratedQuantizedGeometry:f||null==e,supportsCompactGeometry:f,supportsCurrentUser:n(s,"supportsCurrentUserQueries",!1),supportsDefaultSpatialReference:n(s,"supportsDefaultSR",!1),supportsDegeneratedQuantizedGeometry:n(s,"supportsDegeneratedQuantizedGeometry",!1),supportsDisjointSpatialRelationship:n(s,"supportsDisjointSpatialRel",!1),supportsDistance:n(s,"supportsQueryWithDistance",!1),supportsDistinct:n(s,"supportsDistinct",t.supportsAdvancedQueries),supportsExtent:n(s,"supportsReturningQueryExtent",!1),supportsFormatPBF:g&&m.has("pbf"),supportsFullTextSearch:n(s,"supportsFullTextSearch",!1),supportsGeometryProperties:n(s,"supportsReturningGeometryProperties",!1),supportsHavingClause:n(s,"supportsHavingClause",!1),supportsHistoricMoment:n(p,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:n(s,"supportsMaxRecordCountFactor",!1),supportsOrderBy:n(s,"supportsOrderBy",t.supportsAdvancedQueries),supportsPagination:n(s,"supportsPagination",!1),supportsPaginationOnAggregatedQueries:n(s,"supportsPaginationOnAggregatedQueries",!1),supportsPercentileStatistics:n(s,"supportsPercentileStatistics",!1),supportsQuantization:n(t,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:n(t,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:n(a,"allowAnonymousToQuery",!0),supportsQueryByOthers:n(a,"allowOthersToQuery",!0),supportsQueryGeometry:n(t,"supportsReturningQueryGeometry",!1),supportsResultType:n(s,"supportsQueryWithResultType",!1),supportsReturnMesh:!!(0,i.Hz)(t.infoFor3D),supportsSpatialAggregationStatistics:n(s,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:n(s,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:n(t,"useStandardizedQueries",!1),supportsStatistics:n(s,"supportsStatistics",t.supportsStatistics),supportsTopFeaturesQuery:n(s,"supportsTopFeaturesQuery",!1),supportsTrueCurve:n(s,"supportsTrueCurve",!1),tileMaxRecordCount:u(t,"tileMaxRecordCount",void 0)}}function I(t){const e=t.advancedQueryCapabilities,s=n(e,"supportsAdvancedQueryRelated",!1);return{supportsPagination:n(e,"supportsQueryRelatedPagination",!1),supportsCount:s,supportsOrderBy:s,supportsCacheHint:c(e,"queryRelated")}}function S(t){return{supportsCacheHint:c(t.advancedQueryCapabilities,"queryTopFilter")}}function P(t){const e=t?t.queryBinsCapabilities:void 0;return{supportsDate:n(e,"supportsDateBin",!1),supportsFixedInterval:n(e,"supportsFixedIntervalBin",!1),supportsAutoInterval:n(e,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:n(e,"supportsFixedBoundariesBin",!1),supportsStackBy:n(e,"supportsStackBy",!1),supportsSplitBy:n(e,"supportsSplitBy",!1),supportsSnapToData:n(e,"supportsSnapToData",!1),supportsReturnFullIntervalBin:n(e,"supportsReturnFullIntervalBin",!1),supportsFirstDayOfWeek:n(e,"supportsFirstDayOfWeek",!1),supportsNormalization:n(e,"supportsNormalization",!1),supportedStatistics:d(e),supportedNormalizationTypes:y(e)}}function E(t){const e=t.ownershipBasedAccessControlForFeatures,s=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:n(t,"allowGeometryUpdates",!0),supportsGlobalId:n(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:n(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:n(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:n(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:n(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:n(e,"allowAnonymousToDelete",!0),supportsDeleteByOthers:n(e,"allowOthersToDelete",!0),supportsUpdateByAnonymous:n(e,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:n(e,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:n(s,"supportsAsyncApplyEdits",!1),zDefault:u(t,"zDefault",void 0)}}function w(t){return{operations:{supportsAppend:n(t,"supportsAppend",!1),supportsCoverageQuery:t?.playbackInfo?.klv["0601"]??!1,supportsExportClip:n(t,"supportsExportClip",!1),supportsExportFrameset:n(t,"supportsExportFrameset",!1),supportsMensuration:n(t,"supportsMensuration",!1),supportsPreviews:n(t,"supportsPreviews",!1),supportsUpdate:n(t,"supportsUpdate",!1)}}}},69208:(t,e,s)=>{s.d(e,{d:()=>n});var r=s(31635),o=s(10107),i=(s(44208),s(53966),s(87811),s(64108));const n=t=>{const e=t;let s=class extends e{constructor(){super(...arguments),this.customParameters=null}};return(0,r.Cg)([(0,o.MZ)({type:Object,json:{write:{overridePolicy:t=>({enabled:!!(t&&Object.keys(t).length>0)})}}})],s.prototype,"customParameters",void 0),s=(0,r.Cg)([(0,i.$)("esri.layers.mixins.CustomParametersMixin")],s),s}}}]);