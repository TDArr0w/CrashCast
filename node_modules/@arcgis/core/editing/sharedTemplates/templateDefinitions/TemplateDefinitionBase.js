/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import o from"../../../core/Error.js";import{JSONSupport as r}from"../../../core/JSONSupport.js";import{LoadableMixin as t}from"../../../core/Loadable.js";import{EsriPromiseMixin as s}from"../../../core/Promise.js";import{property as a}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/RandomLCG.js";import{reader as l}from"../../../core/accessorSupport/decorators/reader.js";import{subclass as p}from"../../../core/accessorSupport/decorators/subclass.js";import{writer as m}from"../../../core/accessorSupport/decorators/writer.js";import{getSharedTemplateProvider as i}from"../SharedTemplateProvider.js";import{SharedTemplateDefinitionRequiredPropsNotSetError as d}from"../support/sharedTemplateErrors.js";import{namedEditingToolGUIDDict as c}from"../support/toolNames.js";let n=class extends(t(s(r))){constructor(){super(...arguments),this.excludedTools=[],this.featureService=null,this.makeSharedTemplateFromJSON=null,this.view=null}readExcludedTools(e){const o=e.map(e=>c.fromJSON(e));return Array.from(new Set(o))}writeExcludedTools(e,o){e?.length&&(o.excludedTools=e.map(e=>c.toJSON(e.toLowerCase())))}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const r=this.allParts,{featureService:t,makeSharedTemplateFromJSON:s,view:a}=this;if(null==t||null==s||null==a)throw new d;for(const o of r)o.assertIsSupportedPart();const l=i(a,{makeSharedTemplateFromJSON:s}),p=r.filter(e=>null==e.template),m=await l.getTemplates({templateIds:p.map(e=>e.templateId),featureService:t,signal:e?.signal}),c=new Map(m.map(e=>[e.templateId,e]));for(const i of p){const e=c.get(i.templateId);if(null==e)throw new o("internal:missing-template",`Failed to retrieve template for template ID ${i.templateId}`);i.template=e}await Promise.all(r.map(o=>o.template?.load(e)))}};e([a({readOnly:!0})],n.prototype,"type",void 0),e([a({constructOnly:!0})],n.prototype,"excludedTools",void 0),e([l("excludedTools")],n.prototype,"readExcludedTools",null),e([m("excludedTools")],n.prototype,"writeExcludedTools",null),e([a()],n.prototype,"featureService",void 0),e([a()],n.prototype,"makeSharedTemplateFromJSON",void 0),e([a()],n.prototype,"view",void 0),n=e([p("esri.editing.sharedTemplates.templateDefinitions.TemplateDefinitionBase")],n);export{n as TemplateDefinitionBase};
