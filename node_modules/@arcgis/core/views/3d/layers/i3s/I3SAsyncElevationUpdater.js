/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as t}from"tslib";import e from"../../../../core/Accessor.js";import{property as s}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/RandomLCG.js";import{subclass as r}from"../../../../core/accessorSupport/decorators/subclass.js";import{ExtentSet as o}from"../graphics/ExtentSet.js";import{TaskPriority as i}from"../../../support/Scheduler.js";let a=class extends e{constructor(t,e,s,r){super({}),this._updateExtent=e,this._updateNode=s,this._getElevationMode=r,this.readyToRun=!1,this._extentSet=new o,this._nodeSet=new Set;const i=this._taskPriority,a=t.registerTask(this._taskPriority,this);this.addHandles(a),this._task=a,this._lastTaskPriority=i}destroy(){this._extentSet.destroy()}get _taskPriority(){const t=this._getElevationMode();return t&&1===t?i.ELEVATION_ALIGNMENT_SCENE:i.ELEVATION_ALIGNMENT}_updateTaskPriority(){const t=this._taskPriority;t!==this._lastTaskPriority&&(this._task.priority=t,this._lastTaskPriority=t)}addExtent(t){this._extentSet.add(t),this._updateTaskPriority(),this.readyToRun=!0}schedule(t){this._nodeSet.add(t),this._updateTaskPriority(),this.readyToRun=!0}remove(t){this._nodeSet.delete(t),this._updateRunning()}runTask(t){const e=this._extentSet;for(t.run(()=>e.merge(t));!e.empty&&!t.done;){const s=this._updateExtent(e.pop());null!=s&&s.forAll(t=>this.schedule(t)),t.madeProgress()}if(t.done)return;const s=this._nodeSet;for(const r of s)if(s.delete(r),this._updateNode(r),t.madeProgress(),t.done)break;this._updateRunning()}_updateRunning(){this.readyToRun=this._nodeSet.size>0||this._extentSet.size>0}};t([s()],a.prototype,"readyToRun",void 0),a=t([r("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater")],a);export{a as I3SAsyncElevationUpdater};
