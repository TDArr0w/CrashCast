/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{a as e,n as i}from"../../../../chunks/vec32.js";import{create as t}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{Tiles3DTarget as s}from"../i3s/Intersector.js";import{IntersectorResult as n}from"../../webgl-engine/lib/IntersectorResult.js";import{MeshIntersectionOptions as r,computeInvDir as o,intersectAabbInvDir as l}from"../../webgl-engine/lib/RayIntersections.js";class a{constructor(e){this.layerView=e,this.type=8,this.slicePlaneEnabled=!1,this.isGround=!0,this.layerViewUid=e.uid}intersect(a,u,d,m,f,p){if(a.options.filteredLayerViewUids.includes(this.layerView.uid))return;const{results:h,tolerance:w}=a,y=2===a.options.store,{componentObjectCollection:b}=this.layerView.view.stage.renderView,g=new r(w,p,a.options.normalRequired),V=o(d,m,c),j=e(t(),m,d),x=i(t(),j),I=(e,i,t)=>{if(i>=0){if(null!=u&&!u(d,m,i))return;const e=e=>{const n=new s(this.layerView.layer.uid);e.set(this.type,n,i,t)};if(this.isGround&&(null==h.ground.distance||i<h.ground.distance)&&e(h.ground),a.options.isFiltered)return;if((null==h.min.distance||i<h.min.distance)&&e(h.min),(null==h.max.distance||i>h.max.distance)&&e(h.max),y){const i=new n(a.ray);e(i),a.results.all.push(i)}}};this.layerView.forEachVisibleTile(e=>{if(!e.boundingVolumeIntersectsRay(d,x))return;const{componentObjects:i}=e;for(const t of i)l(t.aabbInWorldCoordinates,d,V,0)&&b.intersect(t,d,m,null,g,I)})}}const c=t();export{a as Tiles3DIntersectionHandler};
