/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as t}from"tslib";import{property as e}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/RandomLCG.js";import{subclass as r}from"../../../../core/accessorSupport/decorators/subclass.js";import{getTimeOperator as i}from"../../../../layers/graphics/data/timeSupport.js";import n from"../../../../layers/support/FeatureFilter.js";import{combineTimeExtent as s}from"../../../../layers/support/timeSupport.js";import{getCachedAttributeValue as o}from"../i3s/I3SBinaryReader.js";import{filterInPlace as l}from"../i3s/I3SUtil.js";const u=i=>{const o=i;let l=class extends o{get timeExtent(){return s(this.i3slayer,this.view?.timeExtent,this._get("timeExtent"))}get mergedFilter(){const{filter:t,timeExtent:e}=this;if(null==e)return t;const r=t?.clone()??new n;return null!=e&&(r.timeExtent=r.timeExtent?.intersection(e)??e),r}getTimeFilterDependencies(){const{timeInfo:t}=this.i3slayer;if(null==t)return[];const{startField:e,endField:r}=t;return[e,r]}addTimeFilter(t,e){if(null==e)return;const{timeInfo:r}=this.i3slayer;if(null==r)return;const{startField:i,endField:n,useTime:s}=r;if(!s||null==i&&null==n)return;const o=r.toJSON(),l=e.toJSON();t.push((t,e)=>m(t,e,o,l))}};return t([e({readOnly:!0})],l.prototype,"timeExtent",null),t([e()],l.prototype,"mergedFilter",null),l=t([r("esri.views.3d.layers.support.TemporalSceneLayerView")],l),l};function m(t,e,r,n){const s=e.attributeInfo?.attributeData;if(null==s)return;const{startTimeField:o,endTimeField:u}=r;if(!!(null!=o&&null==s[o]||null!=u&&null==s[u]))return;const m=i(r,n,new a(s));if(null==m)return;const{featureIds:p}=e;l(t,p,m)}class a{constructor(t){this.attributeData=t}getAttribute(t,e){return o(this.attributeData[e],t)}getAttributeAsTimestamp(t,e){const r=this.getAttribute(t,e);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}}export{u as TemporalSceneLayerView};
