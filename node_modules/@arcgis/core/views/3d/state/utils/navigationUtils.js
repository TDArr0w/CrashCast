/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{cyclicalPI as t}from"../../../../core/Cyclical.js";import{deg2rad as e,clamp as n,acosClamped as o,asinClamped as r}from"../../../../core/mathUtils.js";import{createScreenPointArray as a}from"../../../../core/screenUtils.js";import{fromRotation as s,exactEquals as i,rotate as c,multiply as l}from"../../../../core/libs/gl-matrix-2/math/mat4.js";import{IDENTITY as m,create as u}from"../../../../core/libs/gl-matrix-2/factories/mat4f64.js";import{set as f}from"../../../../core/libs/gl-matrix-2/math/vec2.js";import{create as p}from"../../../../core/libs/gl-matrix-2/factories/vec2f64.js";import{f as h,b as M,e as g,t as y,g as b,n as d,s as x,d as j,i as v,h as P,l as z,j as w}from"../../../../chunks/vec32.js";import{create as I}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{create as A,fromPoints as k,axis as T,wrapAxisAngle as U}from"../../../../geometry/support/axisAngle.js";import{coordinateSystemFromOneAxisAndNormalVector as G,vectorCoordinates as R}from"../../../../geometry/support/coordinateSystem.js";import{create as S,fromNormalAndOffset as E,intersectRay as H}from"../../../../geometry/support/plane.js";import{a as q,c as C,l as F,i as O}from"../../../../chunks/sphere.js";import{sm4d as W,sv3d as B}from"../../../../geometry/support/vectorStacks.js";import{fromScreenAtEye as D,fromScreen as J}from"../../support/geometryUtils/ray.js";import{intersectScreen as K}from"../../support/geometryUtils/sphere.js";import L from"../../webgl/RenderCamera.js";import{terrainId as N}from"../../webgl-engine/lib/verticalOffsetUtils.js";const Q=30,V=[1,3e8],X=8,Y=[200,1508e5],Z=5,$=50,_=5,tt=10,et=80,nt=90,ot=1e-6,rt={exclude:new Set([N])};function at(t,e,n){return n[0]=e[0]/(t.fullWidth/t.pixelRatio),n[1]=e[1]/(t.fullHeight/t.pixelRatio),n}function st(t){for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;return t}function it(t,e,n){const o=s(W.get(),n[3],T(n));null==o||i(o,m)||(g(oe,t.eye,e),y(oe,oe,o),t.eye=b(oe,oe,e),g(oe,t.center,e),y(oe,oe,o),t.center=b(oe,oe,e),t.up=y(oe,t.up,o))}function ct(t,e,n,o){return H(t,J(e,n,le),o)}function lt(t,e,n,o){return H(t,D(e,n,le),o)}function mt(t,e,n,o){const r=B.get();let a=1-n;g(r,e,t.eye);const s=M(r);let i=s*(1-a);a>=0&&i<o&&(i=o,a=-(i-s)/s),Math.abs(s-i)<ot||(P(r,r,a),t.eye=b(oe,t.eye,r),t.center=z(oe,t.center,e,a))}function ut(t,e,n){e.getScreenCenter(ft),K(t,e,ft,oe)&&(e.center=oe);const o=e.distance,r=o*n;if(Math.abs(o-r)<ot)return;const a=P(B.get(),e.viewForward,r);e.eye=g(oe,e.center,a)}const ft=a();function pt(t,e){w(e,0,0,0);for(const n of t)b(e,e,n);P(e,e,1/t.length)}function ht(t,e,n,o){return Math.sin(t/M(e))*(n+o.radius)}function Mt(t,e,n,o){return ht(Math.PI/2,e,n,o)+(t-Math.PI/2)}const gt={Elevation:3e4,Angle:e(16)},yt=e(80);function bt(t,e,n,o,r,a){const s=I(),i=C();let c=!0,l=!0;return t.intersectScreen(n,s,a)?i[3]=M(s):(l=!1,e.aboveGround&&0!==r?i[3]=Math.max(M(e.center),.9*o):i[3]=M(e.eye)-e.relativeElevation,1===r?vt(i,e,n,s):c=K(i,e,n,s)),{sphere:i,scenePickPoint:c?s:null,hasGeometryIntersection:l}}function dt(t,e,n,o){const r=t.relativeElevation;if(r>gt.Elevation&&"global"===o)return 1;D(t,e,me);const a=Math.sign(r),s=n.worldUpAtPosition(t.eye,oe);return-a*h(s,me.direction)<Math.sin(gt.Angle)*M(me.direction)?0:1}function xt(t,e,n){g(jt,n,e),t.eye=g(oe,t.eye,jt),t.center=g(oe,t.center,jt)}const jt=I();function vt(t,e,n,o){const r=D(e,n,le);return null!=r&&(F(t,r,Pt),O(t,r,o)?!(x(Pt,r.origin)<x(o,r.origin))||(j(o,Pt),!1):(g(zt,e.eye,e.center),d(zt,zt),E(zt,-h(d(zt,zt),Pt),wt),H(wt,r,o),!1))}const Pt=I(),zt=I(),wt=S();function It(a,s,i,c,l,m){let u=0;if(v(se,a,s),g(re,a,s),M(a)<=l||!c.aboveGround){v(i,re,c.eye);const f=h(a,s)/(M(a)*M(s));if(f<.9999)u=o(f);else{const t=M(v(I(),a,s))/(M(a)*M(s));u=r(t)}const p=Math.cos(n(t.normalize(e(m)),0,yt));u=-u-Math.max(0,M(s)-l)/(p*l)}else g(At,c.eye,c.center),v(i,re,At),u=-M(re)/l;return d(i,i),P(i,i,M(se)),u}const At=I();function kt(r,a,s,i){let c,l;const m=Math.cos(n(t.normalize(e(i)),0,yt));return c=a>s?-(a-s)/(m*s):a<-s?Math.PI-(a+s)/(m*s):o(a/s),l=r>s?-(r-s)/(m*s):r<-s?Math.PI-(r+s)/(m*s):o(r/s),(l-c)*s}function Tt(t,e,n,o,r,a,s,i,c,l){const m=kt(t[2],e[2],a[3],i),u=c?kt(t[0],e[0],a[3],180):e[0]-t[0],p=Math.sin(s)*u-Math.cos(s)*m,M=Math.cos(s)*u+Math.sin(s)*m;d(oe,r);const g=c?p/Math.sqrt(Math.abs(a[3]**2-h(n,oe)**2)):p/a[3],y=M/Math.sqrt(Math.abs(a[3]**2-h(n,o)**2));f(l,g,y)}function Ut(t,e,n,o,r,a,s,i,c,l){v(se,t,e),G(a.up,a.eye,Nt,Qt,Vt),G([0,0,1],a.eye,Jt,Kt,Lt),j(n,Kt),j(o,Jt),d(n,n),P(n,n,M(se)),R(t,d(Qt,Qt),d(Vt,Vt),d(Nt,Nt),Xt),R(e,Qt,Vt,Nt,Yt),Tt(Xt,Yt,t,Jt,Kt,s,i,c,l,r)}function Gt(t,e,n,o,r,a,i){s(_t,r,o),s(te,i,a),l(ee,_t,te),g(e,t,n),y(e,e,ee),b(e,e,n)}function Rt(t,e,n,o,r,a){s(_t,o,n),s(te,a,r),l(ee,_t,te),g(oe,t.eye,e),y(oe,oe,ee),t.eye=b(oe,oe,e),g(oe,t.center,e),y(oe,oe,ee),t.center=b(oe,oe,e),g(oe,t.up,e),y(oe,oe,ee),t.up=b(oe,oe,e)}const St={Pole:.95,Angle:e(18),Tilt:45,TiltHysteresisMargin:1e-7};let Et=!1;function Ht(t,e,n,o,r,a){const s=Math.abs(o)>Math.PI-St.Angle||Math.abs(o)<St.Angle,i=(Math.abs(t[2])<n*St.Pole||Math.abs(e)>n)&&a;return s&&i?!Et&&r<St.Tilt-St.TiltHysteresisMargin?Et=!0:Et&&r>St.Tilt+St.TiltHysteresisMargin&&(Et=!1):Et=!1,Et}function qt(t,e,n,o,r,a){if(a)k(n,o,$t),it(e,q(t),$t);else{const a=It(n,o,ie,e,t[3],r);it(e,q(t),U(ie,a))}}function Ct(t,e,n,o,r,a,s){const i=s?20:1,c=1e-12;let l,m;j(ne,o),ae.copyFrom(e);for(let u=0;u<i&&x(n,ne)>c&&(l=x(n,ne),Ut(n,ne,Kt,Jt,Zt,ae,t,r,a,s),Rt(ae,q(t),Jt,Zt[1],Kt,Zt[0]),Gt(ne,ne,q(t),Jt,Zt[1],Kt,Zt[0]),m=x(n,ne),m<l||0===u);u++)e.copyFrom(ae)}function Ft(n,o,r,a,s,i,c){Ht(r,h(o.up,r),n[3],-t.normalize(e(s)),i,o.aboveGround)?Ct(n,o,r,a,-t.normalize(e(s)),i,c):qt(n,o,r,a,i,c)}function Ot(t,e,n,o,r,a){const{eye:s}=t;G([0,0,1],s,Jt,Kt,Lt);const i=e.translation[0]*n.pan,l="zoom"===r.mode?0:e.translation[1]*n.pan,m=Math.max(Math.sqrt(Math.abs(1-h(t.center,Jt)**2/M(t.center)**2)),.5),u=(Math.sin(a)*l+Math.cos(a)*i)/m,f=-Math.cos(a)*l+Math.sin(a)*i;switch(c(o.pan.matrix,o.pan.matrix,u,Jt),o.pan.enabled=!0,r.mode){case"pan":c(o.pan.matrix,o.pan.matrix,f,Kt),o.pan.enabled=!0;break;case"zoom":o.zoom=-e.translation[1]*n.zoom}}function Wt(t,e,n,o,r){const{eye:a,viewRight:s}=t,i=v(B.get(),s,a),l=e.translation[0]*n.pan;switch(0!==l&&(c(o.pan.matrix,o.pan.matrix,-l,i),o.pan.enabled=!0),r.mode){case"pan":{const t=e.translation[1]*n.pan;0!==t&&(c(o.pan.matrix,o.pan.matrix,t,s),o.pan.enabled=!0);break}case"zoom":o.zoom=-e.translation[1]*n.zoom}}function Bt(n,o,r,a,s,i,c,l,m){Ht(n.center,h(n.up,n.center),M(n.center),-t.normalize(e(i)),c,o.aboveGround)?Ot(o,r,a,l,m,-t.normalize(e(s))):Wt(o,r,a,l,m)}function Dt(t,e,n=1/0){const o=Math.abs(h(t,e));return Math.min(n,1/o)}const Jt=I(),Kt=I(),Lt=I(),Nt=I(),Qt=I(),Vt=I(),Xt=I(),Yt=I(),Zt=p(),$t=A(),_t=u(),te=u(),ee=u(),ne=I(),oe=I(),re=I();let ae=new L;const se=I(),ie=I();function ce(){ae=new L}const le={origin:I(),direction:I()},me={origin:I(),direction:I()};export{yt as TiltThresholdPanningSpeed,gt as VerticalPanTresholds,xt as applyPanPlanar,qt as applyPanSphericalDirectRotation,Ct as applyPanSphericalPreserveHeading,it as applyRotation,Rt as applyRotationWithTwoAxes,ut as applyZoomOnSphere,mt as applyZoomToPoint,pt as centroid,ce as cleanupNavigationUtils,ot as distanceComparisonTolerance,rt as excludeTerrain,Dt as getTiltScaleFactor,dt as inferNavigationMode,ct as intersectPlaneFromScreenPoint,lt as intersectPlaneFromScreenPointAtEye,kt as lengthFromPoints,Z as maxPanDistanceModifier,_ as maxRotatePivotDistanceModifier,Q as maxZoomPivotDistanceModifier,X as maxZoomStepDistanceModifier,$ as minPinchAndPanCameraHeight,tt as minRotatePivotDistance,at as normalizeCoordinate,st as normalizeRotationDelta,Mt as offSurfaceTiltToEyeTiltGlobal,ht as onSurfaceTiltToEyeTiltGlobal,Bt as panMotionToRotationMatrix,Ft as panToPosition,bt as pickPointAndInitSphere,et as pivotSearchAreaSize,St as preservingHeadingThresholds,nt as rotatePivotSearchAreaSize,Gt as rotatePointAroundTwoAxes,It as rotationAngleAndAxisDirectRotation,Ut as rotationAnglesAndAxesHeadingPreserving,Tt as rotationAnglesHeadingPreserving,Ht as shouldPreserveHeading,vt as sphereOrPlanePointFromScreenPoint,V as zoomPivotDistanceClamp,Y as zoomStepDistanceClamp};
