/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import t from"../../../core/Accessor.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/RandomLCG.js";import{subclass as n}from"../../../core/accessorSupport/decorators/subclass.js";import{projectWithoutEngine as i}from"../../../geometry/projectionUtils.js";import{fromExtent as l,empty as s,expand as o,allFinite as a,equals as c}from"../../../geometry/support/aaBoundingRect.js";import{isIntegratedMeshLayer as p,isTiledLayer as u}from"../../../layers/support/layerUtils.js";import{webMercatorWorldExtent as y,geographicWorldExtent as f}from"./TerrainConst.js";import{getTiledLayerInfo as d,isProjectableRasterLayer as E}from"./terrainUtils.js";let m=class extends t{constructor(e){super(e)}initialize(){this.addHandles([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])}destroy(){}get layerViewsExtent(){return this._computeLayerViewsExtent()}get tiledLayersExtent(){return this._computeTiledLayersExtent()}get stencilEnabledExtents(){return this._computeStencilEnabledExtents()}_computeStencilEnabledExtents(){const e=[];return this.layerViews.forEach(t=>{const r=t.layer;if(p(r)&&null!=this.viewSpatialReference){const t=g(r.fullExtent,this.viewSpatialReference);null!=t&&e.push(l(t))}}),e}};function x(e,t){return 1===e?new h(t):new w(t)}e([r({readOnly:!0})],m.prototype,"layerViewsExtent",null),e([r({readOnly:!0})],m.prototype,"tiledLayersExtent",null),e([r({readOnly:!0})],m.prototype,"stencilEnabledExtents",null),e([r()],m.prototype,"viewSpatialReference",void 0),e([r()],m.prototype,"tilingScheme",void 0),e([r()],m.prototype,"defaultTiledLayersExtent",void 0),e([r({constructOnly:!0})],m.prototype,"layers",void 0),e([r({constructOnly:!0})],m.prototype,"layerViews",void 0),m=e([n("esri.views.3d.terrain.ExtentHelper")],m);let h=class extends m{_computeLayerViewsExtent(){return this._globalExtent}_computeTiledLayersExtent(){return this._globalExtent}get _globalExtent(){return this.viewSpatialReference.isWebMercator?y:f}};h=e([n("esri.views.3d.terrain.ExtentHelper.ExtentHelperGlobal")],h);let w=class extends m{_computeLayerViewsExtent(){const e=s(),t=this.viewSpatialReference;this.layerViews.forEach(r=>{const n=r.layer;if(r.isResolved()&&("graphics"!==n.type||!n.internal)){const n=g("fullExtentInLocalViewSpatialReference"in r&&r.fullExtentInLocalViewSpatialReference||r.layer.fullExtent,t);o(e,n,e)}});const r=a(e)?e:null,n=this._get("layerViewsExtent");return c(r,n)?n:r}_computeTiledLayersExtent(){const e=this.tilingScheme;if(!e)return null;const t=this.viewSpatialReference,r=s();this.layers.forEach(n=>{if(n.loaded&&u(n)){const i=d(n,t,2);if(null==i)return;const{tileInfo:l,fullExtent:s}=i,a="tilemapCache"in n?n.tilemapCache?.effectiveMaxLOD:void 0;null!=l&&null!=s&&(E(n)||e.compatibleWith(l,a)&&s.spatialReference.equals(e.spatialReference))&&o(r,s,r)}}),o(r,this.defaultTiledLayersExtent,r);const n=a(r)?r:null,i=this._get("tiledLayersExtent");return c(n,i)?i:n}};function g(e,t){return null==e||e.spatialReference.equals(t)?e:i(e,e.spatialReference,t)}w=e([n("esri.views.3d.terrain.ExtentHelper.ExtentHelperLocal")],w);export{m as ExtentHelper,x as create};
