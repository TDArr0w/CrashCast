/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import e from"../../../../Color.js";import t from"../../../../core/Handles.js";import{watch as r,initial as o}from"../../../../core/reactiveUtils.js";import{fromTranslation as i,mul as s,fromXRotation as a,fromYRotation as n}from"../../../../core/libs/gl-matrix-2/math/mat4.js";import{create as l}from"../../../../core/libs/gl-matrix-2/factories/mat4f64.js";import{t as c}from"../../../../chunks/vec32.js";import{fromValues as m}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{displayFocusMultiplier as p}from"../Slice/sliceToolConfig.js";import{viewshedToolManipulatorConfiguration as f}from"./ViewshedConfiguration.js";import{Manipulator3D as h}from"../../interactive/Manipulator3D.js";import{RenderObject as d}from"../../interactive/RenderObject.js";import{createTubeGeometry as u,createExtrudedTriangle as j}from"../../webgl-engine/lib/GeometryUtil.js";import{ColorMaterial as g}from"../../webgl-engine/materials/ColorMaterial.js";class w extends h{constructor(e,r){super({view:e,autoScaleRenderObjects:!1,worldSized:!1,radius:f.collisionRadius}),this._handles=new t,this._setupManipulatorVisual(r)}destroy(){this._handles.remove(),super.destroy()}_setupManipulatorVisual(e){const t=this._createMaterial(),r=1,o=[m(0,0,0),m(0,0,r)],h=u(t,o,e,16,!1),j=u(t,o,e*p,16,!1),g=b(!1,t,e),w=b(!0,t,e),M=l();i(M,o[o.length-1]),s(M,M,a(v,Math.PI/2)),s(M,M,n(v,Math.PI/2)),g.transformation=M,w.transformation=M,this.renderObjects=[new d(h,1),new d(j,2),new d(g,1),new d(w,2)];const _=m(0,f.getScaleOrientArrowTipLength(!0),0),O=c(_,_,M),x=[...o,O];this.collisionType={type:"line",paths:[x]}}_createMaterial(){const t=new g({cullFace:2,renderOccluded:4,isDecoration:!0});return this._handles.add(r(()=>e.toUnitRGBA(this.view.effectiveTheme.accentColor),e=>t.setParameters({color:e}),o)),t}}function b(e,t,r){const o=f.getScaleOrientArrowTipLength(e);let i=2*r;e&&(i*=p);const s=o/2;return j(t,o,s,s,i,0)}const v=l();export{w as ViewshedArrowManipulator};
