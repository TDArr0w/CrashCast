/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import e from"../../../../Color.js";import{multiplyOpacity as t,getContrast as r}from"../../../../core/colorUtils.js";import{releaseMaybe as i}from"../../../../core/maybe.js";import{watch as o,initial as s}from"../../../../core/reactiveUtils.js";import{DidPointerMoveRecentlyFlag as l}from"./sliceToolUtils.js";import{Manipulator3D as a}from"../../interactive/Manipulator3D.js";import{rotateManipulatorDefaults as n}from"../../interactive/manipulatorUtils.js";import{RenderObject as c}from"../../interactive/RenderObject.js";import{Attribute as m}from"../../webgl-engine/lib/Attribute.js";import{Geometry as u}from"../../webgl-engine/lib/Geometry.js";import{createPolylineGeometry as d}from"../../webgl-engine/lib/GeometryUtil.js";import{ImageMaterial as p}from"../../webgl-engine/materials/ImageMaterial.js";import{RibbonLineMaterial as f}from"../../webgl-engine/materials/RibbonLineMaterial.js";class h extends a{constructor(i,l){const a=t(i.effectiveTheme.accentColor,.5),c=r(i.effectiveTheme.accentColor),m=l(a,c),u=new p({draped:!1,texture:m.texture,writeDepth:!1,renderOccluded:16,isDecoration:!0}),d=n.calloutWidth,h=new f({width:d,renderOccluded:4,isDecoration:!0},i.state.isGlobal);super({view:i,...w({imageMaterial:u,calloutMaterial:h})}),this._material=u,this._textureHandle=m,this._themeHandle=o(()=>i.effectiveTheme.accentColor,i=>{const o=t(i,.5),s=r(i),a=this._textureHandle;this._textureHandle=l(o,s),u.setParameters({texture:this._textureHandle.texture}),a?.release(),h.setParameters({color:e.toUnitRGBA(i)})},s)}destroy(){this._textureHandle=i(this._textureHandle),this._themeHandle.remove(),this._material.dispose(),super.destroy()}}function w({imageMaterial:e,calloutMaterial:t}){const{focusMultiplier:r,calloutLength:i,discRadius:o}=n,s=o*r,a=(e,t)=>{const r=[0,1,2,2,3,0];return new u(t,[["position",new m([i-e,-e,0,i+e,-e,0,i+e,e,0,i-e,e,0],r,3,!0)],["uv0",new m([0,0,1,0,1,1,0,1],r,2,!0)]])},p=d(t,[[0,0,0],[i-o,0,0]]),f=d(t,[[0,0,0],[i-s,0,0]]),h=l;return{autoScaleRenderObjects:!1,collisionPriority:1,collisionType:{type:"disc",direction:[0,0,1],offset:[i,0,0]},focusMultiplier:r,radius:o,renderObjects:[new c(a(o,e),1|h),new c(p,1|h),new c(a(s,e),2|h),new c(f,2|h)],state:h}}export{h as RotateManipulator};
