/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as t}from"tslib";import e from"../../../../core/Accessor.js";import{destroyHandle as o}from"../../../../core/handleUtils.js";import s from"../../../../core/Logger.js";import{mapCollection as r}from"../../../../core/mapCollectionUtils.js";import{watch as i,syncAndInitial as n}from"../../../../core/reactiveUtils.js";import{convertUnit as a}from"../../../../core/unitUtils.js";import{property as l}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/RandomLCG.js";import{subclass as m}from"../../../../core/accessorSupport/decorators/subclass.js";import{getDefaultUnitForView as c}from"../../../../support/getDefaultUnitForView.js";import{isGeodesicDimension as p,computeGeometryFromDimension as u,computeLength as d,computationToGeometryDependencies as y}from"./lengthDimensionUtils.js";import{geodesicDistanceThreshold as h}from"../../../support/geodesicMeasurementUtils.js";let f=class extends e{constructor(t){super(t)}initialize(){const t=r(()=>this.analysisViewData.computations,({computation:t})=>this._watchComputation(t));this.addHandles(o(t))}get analysis(){return this.analysisViewData.analysis}get _defaultUnit(){return c(this.view)}_watchComputation(t){return i(()=>y(t),e=>{const{measureType:o}=e;if(p(e)&&"direct"!==o){const e=Math.round(a(h,"meters","kilometers"));return s.getLogger(this).warnOnce(`A ${o} dimension in the analysis (id: '${this.analysis.id}') will not display, because only direct dimensions can measure lengths greater than ${e} km. Update the measureType of the affected dimension to "direct" to display it.`),void(t.geometry=null)}const r=u(e,this.view.renderCoordsHelper,t.geometry);t.geometry=r,t.result.length=d(r,o,this._defaultUnit,this.automaticLengthMeasurementUtils)},n)}};t([l({constructOnly:!0})],f.prototype,"analysisViewData",void 0),t([l({constructOnly:!0})],f.prototype,"view",void 0),t([l({constructOnly:!0})],f.prototype,"automaticLengthMeasurementUtils",void 0),t([l()],f.prototype,"analysis",null),t([l()],f.prototype,"_defaultUnit",null),f=t([m("esri.views.3d.analysis.Dimension.DimensionController")],f);export{f as DimensionController};
