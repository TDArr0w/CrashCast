/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{newLayout as e}from"../../support/buffer/InterleavedLayout.js";import{isColorOrColorEmission as t}from"../core/shaderLibrary/ShaderOutput.js";import{ReloadableShaderModule as r}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as i,depthOnlyOutputBuffersOr as o}from"../core/shaderTechnique/ShaderTechnique.js";import{olidEnabled as l}from"../effects/geometry/olidUtils.js";import{oitPolygonOffset as n,depthWrite as s,oitDepthTest as c,blending as u,getDrawBuffers as a}from"../lib/OrderIndependentTransparency.js";import{stencilToolMaskBaseParams as p,stencilBaseAllZerosParams as d,stencilWriteMaskOn as f}from"../lib/StencilUtils.js";import{P as m}from"../../../../chunks/Pattern.glsl.js";import{makePipelineState as h,defaultColorWrite as P,cullingParams as g}from"../../../webgl/renderState.js";class S extends i{constructor(e,t){super(e,t,new r(m,()=>import("./Pattern.glsl.js")),b(t).locations)}_setPipelineState(e,r){const{oitPass:i,output:l,cullFace:m,draped:S,hasOccludees:b,polygonOffset:v}=e,y=0===i;return h({blending:t(l)?u(i):null,culling:g(m),depthTest:S?null:{func:c(i)},depthWrite:s(e),drawBuffers:o(l,a(i,l)),colorWrite:P,stencilWrite:b?f:null,stencilTest:b?r?p:d:null,polygonOffset:y?v?j:null:n(e)})}initializePipeline(e){return this._occludeePipelineState=this._setPipelineState(e,!0),this._setPipelineState(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}const j={factor:1,units:1};function b(t){const r=e().vec3f("position").vec4f("uvMapSpace");return t.draped||r.mat3f("boundingRect"),t.hasVVColor?r.f32("colorFeatureAttribute"):r.vec4u8("color"),l()&&r.vec4u8("olidColor"),r.freeze()}export{S as PatternTechnique,b as getLayout};
