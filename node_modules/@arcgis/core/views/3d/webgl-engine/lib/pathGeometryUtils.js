/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{d as t,j as e,g as r,b as s,n as o,i}from"../../../../chunks/vec32.js";import{create as m}from"../../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{create as a,fromPositionAndNormal as f,intersectRay as p}from"../../../../geometry/support/plane.js";import{wrap as c}from"../../../../geometry/support/ray.js";import{makeOrthoBasisDirUpFallback as g}from"./GeometryUtil.js";function l(l,v){let h=null;const u=l.vertices.length,j=.99619469809,R=m(),y=m(),b=m(),x=m(),L=m(),d=m(),k=a();let q=l.vertices[0];t(y,v),e(R,0,1,0),g(q.vRight,y,R,R,b,y,j),t(q.frame.up,y),t(q.frame.right,b);const G=l.positions;let M=l.offset;h=q;for(let m=1;m<u;++m){q=l.vertices[m],r(L,q.vLeft,q.vRight);let a=s(L);a>0?(a=1/Math.sqrt(a),L[0]=L[0]*a,L[1]=L[1]*a,L[2]=L[2]*a):(L[0]=q.vRight[0],L[1]=q.vRight[1],L[2]=q.vRight[2]),d[0]=G[M]+h.frame.up[0],d[1]=G[M+1]+h.frame.up[1],d[2]=G[M+2]+h.frame.up[2],M+=3;const v=e(n,G[M],G[M+1],G[M+2]);f(v,L,k);p(k,c(d,q.vLeft),x)?(x[0]-=G[M],x[1]-=G[M+1],x[2]-=G[M+2],o(y,x),i(b,L,y),o(b,b)):g(L,h.frame.up,h.frame.right,R,b,y,j),t(q.frame.up,y),t(q.frame.right,b),h=q}}const n=m();export{l as computeMinimumRotationTangentFrame};
