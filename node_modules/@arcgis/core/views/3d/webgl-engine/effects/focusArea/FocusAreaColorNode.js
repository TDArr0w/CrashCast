/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import{watch as r}from"../../../../../core/reactiveUtils.js";import{property as s}from"../../../../../core/accessorSupport/decorators/property.js";import"../../../../../core/has.js";import"../../../../../core/Logger.js";import"../../../../../core/RandomLCG.js";import{subclass as t}from"../../../../../core/accessorSupport/decorators/subclass.js";import{InternalRenderCategory as o}from"../../../webgl.js";import i from"../../../webgl/RenderNode.js";import{F as a}from"../../../../../chunks/FocusAreaColor.glsl.js";import{FocusAreaColorTechnique as c}from"./FocusAreaColorTechnique.js";import{DepthStencilAttachment as n}from"../../../../webgl/enums.js";let m=class extends i{constructor(e){super({...e,view:e.focusAreasView.view}),this.consumes={required:[o.FOCUSAREA_COLOR,o.FOCUSAREA]},this.produces=o.FOCUSAREA_COLOR,this._fadeDirection=0,this._passParameters=new a}precompile(){this.techniques.precompile(c)}fadeOut(e){this.removeAllHandles(),this._startTime=null,this._fadeDirection=1,this.addHandles(r(()=>this._passParameters.fadeFactor.value,r=>{0===r&&(this.removeAllHandles(),e())})),this.requestRender(2)}render(e){const r=this.techniques.get(c),s=e.find(({name:e})=>e===this.produces);if(!r.compiled)return this.requestRender(1),s;const t=this.focusAreasView.style,i=this.bindParameters,a=i.camera,m=a.fullViewport[2],p=a.fullViewport[3];this._startTime??=this.view.stage?.renderer.renderContext.time;const h=this.view.qualitySettings.fadeDuration,u=h>0?Math.min(h,this.view.stage?.renderer.renderContext.time-this._startTime)/h:1,l=e.find(({name:e})=>e===o.FOCUSAREA),f=this.fboCache.acquire(m,p,this.produces),A=this.renderingContext;return A.bindFramebuffer(f.fbo),this._passParameters.color=s.getTexture(),this._passParameters.focusArea=l.getTexture(),this._passParameters.effect=d[t],this._passParameters.fadeFactor.value=0===this._fadeDirection?u:1-u,A.bindTechnique(r,i,this._passParameters),A.screen.draw(),f.attachDepth(s.getAttachment(n)),u<1&&this.requestRender(2),f}};e([s()],m.prototype,"consumes",void 0),e([s()],m.prototype,"produces",void 0),e([s({constructOnly:!0})],m.prototype,"focusAreasView",void 0),m=e([t("esri.views.3d.webgl-engine.effects.focusArea.FocusAreaColorNode")],m);const d={bright:0,dark:1};export{m as FocusAreaColorNode};
