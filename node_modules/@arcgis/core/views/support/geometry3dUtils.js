/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{floatEqualAbsolute as t}from"../../core/mathUtils.js";import{subtract as n,length as r,scaleAndAdd as s,sub as e,dot as o,squaredLength as c,lerp as i,set as u,distance as a,squaredDistance as f}from"../../core/libs/gl-matrix-2/math/vec2.js";import{create as p,fromValues as m,ZEROS as d}from"../../core/libs/gl-matrix-2/factories/vec2f64.js";import{a as h,f as l,c as y,j,i as b,y as M,e as g,d as x,k as q,H as v}from"../../chunks/vec32.js";import{create as k,clone as U}from"../../core/libs/gl-matrix-2/factories/vec3f64.js";import{getEpsilon as L}from"../../core/libs/gl-matrix-2/math/common.js";import{fromPositionAndNormal as w,create as A,distance as C,intersectLine as H,isPointInside as P}from"../../geometry/support/plane.js";import{tangentFrame as z}from"../3d/support/mathUtils.js";import{intersectLineLikeAndCircle as B}from"./geometry2dUtils.js";function D({start:t,end:r,type:e},i,u){const a=[],f=n(rt,r,t),m=n(st,t,i),d=c(f),h=2*o(f,m),l=h*h-4*d*(c(m)-u*u);if(0===l){const n=-h/(2*d);(0===e||n>=0)&&a.push(s(p(),t,f,n))}else if(l>0){const n=Math.sqrt(l),r=(-h+n)/(2*d);(0===e||r>=0)&&a.push(s(p(),t,f,r));const o=(-h-n)/(2*d);(0===e||o>=0)&&a.push(s(p(),t,f,o))}return a}function E(t,r){const s=t.start,c=t.end,i=n(rt,c,s),u=j(ot,-i[1],i[0],0),a=r.start,f=r.end,p=h(ct,f,a),m=l(p,u),d=j(it,s[0],s[1],0),b=h(ut,d,a),M=l(b,u),g=L();if(Math.abs(m)<g)return Math.abs(M),[];const x=y(at,a,p,M/m);if(0===r.type){const t=h(ft,x,a);if(l(t,p)<-g)return[]}if(1===t.type){const t=e(st,x,s);if(o(t,i)<-g)return[]}return[U(x)]}function F(t,n){return V(Y(mt,n[2],t),n)}function G(t,n){const r=0;return T(Y(mt,r,t),Y(dt,r,n)).map(([t,n])=>m(t,n))}function I(t,n,r){return O(t,Y(mt,t[2],n),r)}function J(t,n){return Q(Y(mt,t[2],n),t)}function K(t,e,o,c=k()){const i=n(rt,t,e),u=r(i);return s(c,e,i,0===u?1:o/u),c[2]=t[2],c}function N(t,n,r){return a(t,n)-r}function O(t,{start:n,end:r,type:s},e=k()){const o=h(et,t,n),c=h(ot,r,n),i=l(o,c)/l(c,c);return y(e,n,c,0===s?Math.max(i,0):i)}function Q({start:t,end:n,type:r},s){const e=h(et,s,t),o=h(ot,n,t);if(0===r&&l(o,e)<-L())return q(t,s);const c=b(ct,o,e);return v(c)/v(o)}const R=(()=>{const t=k(),n=k(),r=k();return({start:s,end:e},{center:o,radius:c,normal:i,slicePlane:a})=>{const f=w(o,i,pt);if($(C(f,s),0)&&$(C(f,e),0)){z(i,t,n);const f=(s,e)=>(g(r,e,o),u(s,l(r,t),l(r,n)),s),p=B({start:f(rt,s),end:f(st,e),type:1},d,c),m=[];for(const[r,s]of p){const e=x(k(),o);y(e,e,t,r),y(e,e,n,s),a&&!tt(a,e)||m.push(e)}return m}const p=k();return H(f,s,e,p)?!$(q(p,o),c)||a&&!tt(a,p)?[]:[p]:[]}})();function S({start:t,end:r,type:s},e,i){const u=[],a=g(et,r,t),f=n(st,t,e),p=c(a),m=2*o(a,f),d=m*m-4*p*(c(f)-i*i);if(0===d){const n=-m/(2*p);(1===s||n>=0)&&u.push(y(k(),t,a,n))}else if(d>0){const n=Math.sqrt(d),r=(-m+n)/(2*p);(1===s||r>=0)&&u.push(y(k(),t,a,r));const e=(-m-n)/(2*p);(1===s||e>=0)&&u.push(y(k(),t,a,e))}return u}function T(t,n){const r=t.start,s=t.end,e=n.start,o=n.end,c=h(et,s,r),i=h(ot,o,e),u=h(ct,e,r),a=b(it,c,i);if(!$(l(u,a),0))return[];const f=M(a);if($(f,0))return[];const p=b(ut,u,i),m=l(p,a)/f,d=y(at,r,c,m);if(0===t.type){const t=h(ft,d,r);if(l(c,t)<-L())return[]}if(0===n.type){const t=h(ft,d,e);if(l(i,t)<-L())return[]}return[U(d)]}function V({start:t,end:n,type:r},s){const e=h(et,s,t),o=h(ot,n,t),c=b(ct,o,e),i=M(c)/M(o),u=L();if(i<u)switch(r){case 1:return[U(s)];case 0:return l(o,e)<-u?[]:[U(s)]}return[]}function W(t,n,r){return $(f(r,t),n*n)?[U(r)]:[]}function X(t,n,r,s){const[e,o]=t,[c,u]=r,a=c-e,f=u-o,p=a*a+f*f,d=Math.sqrt(p);if(d>n+s)return[];if(d<Math.abs(n-s))return[];if($(d,0)&&$(n,s))return[];const h=(n*n-s*s+p)/(2*d),l=Math.sqrt(n*n-h*h),y=l*f/d,j=l*a/d,[b,M]=i(rt,t,r,h/d);return $(y,j)?[m(b,M)]:[m(b+y,M-j),m(b-y,M+j)]}function Y(t,n,{start:r,end:s,type:e}){return j(t.start,r[0],r[1],n),j(t.end,s[0],s[1],n),t.type=nt[e],t}function Z(t,n){return $(t[2],n[2])}function $(n,r){return t(Math.abs(n-r),0,L())}function _(t,n){return n.filter(n=>tt(t,n))}function tt(t,n){return P(t,n)}const nt={0:1,1:0},rt=p(),st=p(),et=k(),ot=k(),ct=k(),it=k(),ut=k(),at=k(),ft=k(),pt=A(),mt={start:k(),end:k(),type:1},dt={start:k(),end:k(),type:1};export{V as intersectLineAndPoint,R as intersectLineLikeAndCircle,S as intersectLineLikeAndVerticalCylinder,T as intersectLineLikes,W as intersectVerticalCylinderAndPoint,X as intersectVerticalCylinders,E as intersectVerticalPlaneAndLineLike,F as intersectVerticalPlaneAndPoint,D as intersectVerticalPlaneAndVerticalCylinder,G as intersectVerticalPlanes,$ as isClose,tt as isPointInsidePlane,Q as pointToLineLikeDistance,N as pointToVerticalCylinderDistance,J as pointToVerticalPlaneDistance,_ as pointsInsidePlane,O as projectPointToLineLike,K as projectPointToVerticalCylinder,I as projectPointToVerticalPlane,Z as vectorsHaveCloseZ};
