/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../../../../core/arrayUtils.js";import{internalTrackPartField as i}from"../../../../../../layers/support/streamLayerUtils.js";import{simplifyVisualVariables as r}from"../../support/rendererUtils.js";import{getWebGLCapabilities as n}from"../../../../../webgl/capabilities.js";function t(e,i){return{type:"simple",filters:i,capabilities:{maxTextureSize:n().maxTextureSize},bindings:o(e)}}function s(e,r){const t=n();return{type:"multi",target:"feature",keyField:i,filters:r,capabilities:{maxTextureSize:t.maxTextureSize},bindings:{0:o(e.trackLines.renderer),1:o(e.latestObservations.renderer),2:o(e.previousObservations.renderer)}}}function a(e){switch(e){case"opacity":return 2;case"color":return 1;case"rotation":return 3;case"size":return 0;default:return null}}function o(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return p(e);case"dot-density":return l(e);case"pie-chart":return u(e);case"heatmap":return c(e)}}function l(e){const i=[];for(const r of e.attributes)i.push({binding:i.length,expression:r.valueExpression,field:r.field});return i}function u(e){const i=p(e);let r=4;for(const n of e.attributes)i.push({binding:r++,expression:n.valueExpression,field:n.field});return i}function c({valueExpression:e,field:i}){return e||i?[{binding:0,expression:e,field:i}]:[]}function p(i){if(!("visualVariables"in i)||!i.visualVariables?.length)return[];return r(i.visualVariables).map(e=>b(e)).filter(e)}function f(e){return"$view.scale"===e.valueExpression?null:{binding:a(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}function d(e){return{binding:a(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function m(e){return{binding:a(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function x(e){return{binding:a(e.type),expression:e.valueExpression,field:e.field}}function b(e){switch(e.type){case"size":return f(e);case"color":return d(e);case"opacity":return m(e);case"rotation":return x(e)}}export{l as createDotDensityBindings,c as createHeatmapBindings,u as createPieChartBindings,t as createStorageSchema,s as createTrackStorageSchema,p as createVVBindings};
