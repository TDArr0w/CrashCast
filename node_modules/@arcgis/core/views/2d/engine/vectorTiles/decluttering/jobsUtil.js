/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{identity as t,translate as o,rotate as e,scale as r}from"../../../../../core/libs/gl-matrix-2/math/mat3.js";import{create as s}from"../../../../../core/libs/gl-matrix-2/factories/mat3f32.js";import{toRadian as i}from"../../../../../core/libs/gl-matrix-2/math/common.js";import{tileCoordSize as l}from"../constants.js";import{CollisionJob as m}from"./CollisionJob.js";import{SymbolDeclutterer as n}from"./SymbolDeclutterer.js";import{SymbolRepository as a}from"./SymbolRepository.js";import{writeOpacityToBuffers as c}from"./util.js";function f(s,f){const y=s.transforms.tileUnitsToPixels,u=i(f),b=Math.cos(u),g=Math.sin(u),h=Math.ceil(512*(Math.abs(g)+Math.abs(b)));t(p),o(p,p,[h/2,h/2]),e(p,p,u),o(p,p,[-256,-256]),r(p,p,[1/8,1/8,1]),s.transforms.tileUnitsToPixels=p;const j=[],x=new a(l,j),M=new n("vector-tile",j,x,null,(t,o,e)=>new m(t,o,e,s.styleRepository,s.key.level,f),(t,o)=>{c(t,o,!1)},()=>0,t=>{const o=s.styleRepository.getStyleLayerByUID(t).getLayoutProperty("visibility");return!o||1!==o.getValue()});j.push(s),x.registerVectorTile(s),M.setScreenSize(h,h),M.continue(1/0),x.unregisterVectorTile(s),s.transforms.tileUnitsToPixels=y}const p=s();export{f as declutterSingleTile};
