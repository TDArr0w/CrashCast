/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import{deprecateWidget as o}from"../core/deprecate.js";import t from"../core/Logger.js";import{memoize as r}from"../core/memoize.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import"../core/has.js";import"../core/RandomLCG.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import{weatherTypesArray as n}from"../views/3d/environment/weather.js";import a from"./Widget.js";import{loadCalciteComponents as l}from"./support/componentsUtils.js";import{globalCss as c}from"./support/globalCss.js";import{Heading as d}from"./support/Heading.js";import{classes as p}from"./support/widgetUtils.js";import{messageBundle as u}from"./support/decorators/messageBundle.js";import{tsx as h,tsxFragment as g}from"./support/jsxFactory.js";import"@arcgis/toolkit/dom";import{css as m}from"./Weather/css.js";import{LabeledSlider as v}from"./Weather/LabeledSlider.js";import y from"./Weather/VisibleElements.js";import b from"./Weather/WeatherViewModel.js";const w={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let C=class extends a{constructor(e){super(e),this.viewModel=new b({isDefaultViewModel:!0}),this.headingLevel=4,this.visibleElements=new y,this._renderWeatherTypeButton=e=>{const o=this.viewModel,t=this.messages[e].label,r="disabled"===o.state,s=!r&&o.current.type===e;return h("calcite-button",{appearance:s?"solid":"outline","aria-checked":s?"true":"false",disabled:r,iconStart:w[e],key:`${e}-type-button`,kind:s?"brand":"neutral",label:t,onclick:()=>{s||o.setWeatherByType(e)},scale:"l",title:t})},this._memoizedCallbacks=r(e=>({onCloudCoverChange:o=>{"cloudCover"in e&&(e.cloudCover=o)},onPrecipitationChange:o=>{"precipitation"in e&&(e.precipitation=o)},onFogStrengthChange:o=>{"fogStrength"in e&&(e.fogStrength=o)},onSnowCoverChange:e=>{this.viewModel.setSnowCoverEnabled(e.currentTarget.checked)}})),o(t.getLogger(this),"Weather","arcgis-weather",{version:"4.33"})}render(){const e="disabled"===this.viewModel.state;return h("div",{"aria-label":this.messages.widgetLabelAccessible,class:this.classes(m.base,c.widget,e&&c.widgetDisabled),role:"region"},this._renderContent())}loadDependencies(){return l({button:()=>import("@esri/calcite-components/dist/components/calcite-button"),checkbox:()=>import("@esri/calcite-components/dist/components/calcite-checkbox"),icon:()=>import("@esri/calcite-components/dist/components/calcite-icon"),label:()=>import("@esri/calcite-components/dist/components/calcite-label")})}get view(){return this.viewModel?.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get icon(){return"partly-cloudy"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get _errorMessage(){const e=this.messages.error;switch(this.viewModel.error){case"local-scene":return e.localScene;case"no-atmosphere":return e.noAtmosphere;case"unsupported-view":return e.unsupported;default:return null}}get _warningMessage(){if("not-visible"===this.viewModel.error){return null!=this.view&&"3d"===this.view?.type&&this.view.environment.atmosphereEnabled?this.messages.error.notVisible:null}return null}_renderContent(){const{headingLevel:e,messages:o,viewModel:t,visibleElements:r}=this,s=this._warningMessage,i=t.current,a="error"===t.state;return h(g,null,r.header?h(d,{level:e},o.widgetLabel):null,a?h("div",{class:m.error,key:"error"},this._errorMessage):null,h("div",{class:p({[m.content]:!0,[m.hasError]:a}),key:"content"},h("div",{"aria-label":o.weatherType,class:m.selector,key:"type-selector",role:"radiogroup"},n.map(this._renderWeatherTypeButton)),Object.values(t.weatherByType).map(e=>h("div",{class:p({[m.options]:!0,[m.optionsHidden]:e.type!==i?.type}),key:"options-container"},this._renderOptions(e))),null!=s?this._renderWarning(s):null))}_renderOptions(e){const{viewModel:o,messages:t}=this,r="disabled"===o.state,s=this._memoizedCallbacks(e);switch(e.type){case"sunny":return h(v,{disabled:r,key:"sunny-cover",label:t.sunny.cloudCover,value:e.cloudCover,onChange:s.onCloudCoverChange});case"cloudy":return h(v,{disabled:r,key:"cloudy-cover",label:t.cloudy.cloudCover,value:e.cloudCover,onChange:s.onCloudCoverChange});case"rainy":return h(g,null,h(v,{disabled:r,key:"rainy-cover",label:t.rainy.cloudCover,value:e.cloudCover,onChange:s.onCloudCoverChange}),h(v,{disabled:r,key:"rainy-precipitation",label:t.rainy.precipitation,value:e.precipitation,onChange:s.onPrecipitationChange}));case"snowy":return h(g,null,h(v,{disabled:r,key:"snowy-cloud-cover",label:t.snowy.cloudCover,value:e.cloudCover,onChange:s.onCloudCoverChange}),h(v,{disabled:r,key:"snowy-precipitation",label:t.snowy.precipitation,value:e.precipitation,onChange:s.onPrecipitationChange}),h("calcite-label",{key:"snow-cover",layout:"inline",scale:"s",title:t.snowy.snowCoverTooltip},h("calcite-checkbox",{checked:"enabled"===e.snowCover,disabled:r,onCalciteCheckboxChange:s.onSnowCoverChange}),t.snowy.snowCover));case"foggy":return h(v,{disabled:r,key:"foggy-cover",label:t.foggy.fogStrength,value:e.fogStrength,onChange:s.onFogStrengthChange})}}_renderWarning(e){return h("div",{class:m.warning,key:"warning"},h("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),e)}};e([s()],C.prototype,"viewModel",void 0),e([s()],C.prototype,"view",null),e([s()],C.prototype,"headingLevel",void 0),e([s({type:y,nonNullable:!0})],C.prototype,"visibleElements",void 0),e([s()],C.prototype,"icon",null),e([s()],C.prototype,"label",null),e([s(),u("esri/widgets/Weather/t9n/Weather")],C.prototype,"messages",void 0),e([s()],C.prototype,"_errorMessage",null),e([s()],C.prototype,"_warningMessage",null),C=e([i("esri.widgets.Weather")],C);const f=C;export{f as default};
