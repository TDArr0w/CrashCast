/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import s from"../../../../Color.js";import"../../../../intl.js";import{property as t}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/RandomLCG.js";import{subclass as i}from"../../../../core/accessorSupport/decorators/subclass.js";import r from"../../../Widget.js";import l from"./ColorRamp.js";import{css as a}from"./css.js";import o from"./SizeRamp.js";import n from"./UnivariateAboveAndBelowRamp.js";import c from"./UnivariateColorSizeRamp.js";import{renderRelationshipRamp as p}from"../support/relationshipUtils.js";import{getLegendElementTitle as h,getPreviewAriaLabelIntl as m}from"../support/utils.js";import{attachToNode as d,isImageryStretchedLegend as y,getTitle as g}from"../../support/styleUtils.js";import{Heading as f,incrementHeadingLevel as u}from"../../../support/Heading.js";import"../../../support/widgetUtils.js";import{tsx as b}from"../../../support/jsxFactory.js";import"@arcgis/toolkit/dom";import{substitute as v}from"../../../../intl/substitute.js";var E;let w=E=class extends r{constructor(e,s){super(e,s),this.cssEffectFilter=null,this.hasIndicators=!1,this.headingLevel=3,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),s=h(this.legendElement,this.messages),t=this.hasIndicators&&!this.isChild?b("div",null,b(f,{class:a.carouselTitle,level:this.headingLevel},this.activeLayerInfo.title),b(f,{class:a.layerCaption,level:u(this.headingLevel)},s)):s?b(f,{class:a.layerCaption,level:this.headingLevel},s):null;return b("section",{"aria-labelledby":this.key,class:a.section,id:`${this.key}-panel`,key:this.key,role:"tabpanel",tabIndex:0},t,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return b(o,{hasIndicators:this.hasIndicators,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return b(l,{cssEffectFilter:this.cssEffectFilter,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return p(this.legendElement,this.id,{opacity:this.layer.opacity,cssEffectFilter:this.cssEffectFilter,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":{const{preview:e}=this.legendElement;if(!e)return null;const s=v(this.messages.previewPieChartAriaLabel,{label:null});return s&&e.querySelector("svg")?.setAttribute("aria-label",s),b("div",{afterCreate:d,bind:e,class:a.pieChartRampPreview,key:`${this.key}-preview`})}case"univariate-above-and-below-ramp":return b(n,{cssEffectFilter:this.cssEffectFilter,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return b(c,{cssEffectFilter:this.cssEffectFilter,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const s=e.infos.map(s=>this._renderElementInfo(s,e.legendType)).filter(Boolean);if(!s.length)return null;const t=this.activeLayerInfo.legendElements.some(({type:e})=>"relationship-ramp"===e),i=s[0]?.properties?.classes?.[a.symbolRow],r={[a.labelContainer]:!i&&!t,[a.relationshipLabelContainer]:t};return b("div",{class:this.classes(r)},s)}_renderElementInfo(e,s){const{layer:t}=this,i="label"in e?e.label:null,r=`${this.key}-${i}`;if("type"in e&&e.type)return b(E,{activeLayerInfo:this.activeLayerInfo,cssEffectFilter:this.cssEffectFilter,hasIndicators:this.hasIndicators,headingLevel:this.headingLevel,isChild:!0,key:r,layer:t,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const l=y(t,s),o=g(this.messages,i,!1)||"";if("src"in e&&e.src)return b("div",{class:a.layerRow,key:`${r}-row`},this._renderImage(e,t,l),b("div",{class:a.imageLabel},o));if("symbol"in e&&e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return b("div",{afterCreate:d,bind:e.preview,key:`${r}-row`});const s={[a.symbolCell]:this.hasIndicators},{preview:t}=e,i="previewAriaLabel"in e?e.previewAriaLabel:null,l="label"in e?g(this.messages,e.label,!1):null,n=t.querySelector("svg"),c=m(this.messages,i||l);return c&&n&&n.setAttribute("aria-label",c),b("div",{class:this.classes(a.layerRow,{[a.symbolRow]:this.hasIndicators}),key:`${r}-row`},b("div",{afterCreate:d,bind:t,class:this.classes(s)}),b("div",{class:this.classes(a.imageLabel,{[a.labelCell]:this.hasIndicators})},o))}return b("div",{class:a.layerRow,key:`${r}-row`},b("div",{class:a.labelElement,styles:this._getBackgroundStyles(e)},o))}return null}_getBackgroundStyles(e){const t=e.symbol,i=t.color,r=!!i?.a,l="outline"in t?t.outline:null,a=!!l?.color?.a,o=new s(r&&i?[i.r,i.g,i.b,i.a*this.layer.opacity]:[255,255,255,0]),n=a&&l.color?new s([l.color.r,l.color.g,l.color.b,l.color.a*this.layer.opacity]):new s([255,255,255,0]),c=e.symbol.color?.isBright??!0,p=c?"black":"white",h=c?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return{background:r?o.toCss(!0):"none",color:p,textShadow:`-1px -1px 0 ${h},\n                  1px -1px 0 ${h},\n                  -1px 1px 0 ${h},\n                  1px 1px 0 ${h}`,border:a?`1px solid ${n.toCss(!0)}`:"none",filter:this.cssEffectFilter??void 0}}_renderImage(e,s,t){const{previewAriaLabel:i,src:r,opacity:l}=e,o=g(this.messages,e.label,!1),n={[a.imageryLayerStretchedImage]:t,[a.symbol]:!t},c={opacity:`${l??s.opacity}`},p=m(this.messages,i||o);return b("img",{alt:p,"aria-label":p,border:0,class:this.classes(n),height:e.height,src:r,styles:c,width:e.width})}};e([t()],w.prototype,"activeLayerInfo",void 0),e([t()],w.prototype,"cssEffectFilter",void 0),e([t()],w.prototype,"hasIndicators",void 0),e([t()],w.prototype,"headingLevel",void 0),e([t()],w.prototype,"isChild",void 0),e([t()],w.prototype,"layer",void 0),e([t()],w.prototype,"legendElement",void 0),e([t()],w.prototype,"messages",void 0),w=E=e([i("esri.widgets.Legend.styles.card.LegendElement")],w);export{w as default};
