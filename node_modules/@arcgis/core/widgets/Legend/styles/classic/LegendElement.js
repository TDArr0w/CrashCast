/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import"../../../../intl.js";import{property as s}from"../../../../core/accessorSupport/decorators/property.js";import"../../../../core/has.js";import"../../../../core/Logger.js";import"../../../../core/RandomLCG.js";import{subclass as t}from"../../../../core/accessorSupport/decorators/subclass.js";import r from"../../../Widget.js";import i from"./ColorRamp.js";import{css as l}from"./css.js";import a from"./SizeRamp.js";import o from"./UnivariateAboveAndBelowRamp.js";import n from"./UnivariateColorSizeRamp.js";import{renderRelationshipRamp as m}from"../support/relationshipUtils.js";import{getLegendElementTitle as c,getPreviewAriaLabelIntl as p}from"../support/utils.js";import{attachToNode as h,isImageryStretchedLegend as y,getTitle as d}from"../../support/styleUtils.js";import"../../../support/widgetUtils.js";import{tsx as g}from"../../../support/jsxFactory.js";import"@arcgis/toolkit/dom";import{substitute as u}from"../../../../intl/substitute.js";var f;let b=f=class extends r{constructor(e,s){super(e,s),this.cssEffectFilter=null,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),s=c(this.legendElement,this.messages),t=this.isChild?l.layerChildTable:l.layerTable,r=s?g("div",{class:l.layerCaption},s):null,i={[l.layerTableSizeRamp]:"size-ramp"===this.legendElement.type||!this.isChild};return g("section",{class:this.classes(t,i),key:`${this.key}-table`},r,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return g(a,{key:this.key,legendElement:this.legendElement,messages:this.messages});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return g(i,{key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return m(this.legendElement,this.id,{opacity:this.layer.opacity,cssEffectFilter:this.cssEffectFilter,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":{const{preview:e}=this.legendElement;if(!e)return null;const s=u(this.messages.previewPieChartAriaLabel,{label:null});return s&&e.querySelector("svg")?.setAttribute("aria-label",s),g("div",{afterCreate:h,bind:e,key:`${this.key}-preview`})}case"univariate-above-and-below-ramp":return g(o,{cssEffectFilter:this.cssEffectFilter,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return g(n,{cssEffectFilter:this.cssEffectFilter,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const s=e.infos.map(s=>this._renderElementInfo(s,e.legendType)).filter(Boolean);return s.length?g("div",{class:l.layerBody},s):null}_renderElementInfo(e,s){const{layer:t}=this,r="label"in e?e.label:null,i=`${this.key}-${r}`;if("type"in e&&e.type)return g(f,{cssEffectFilter:this.cssEffectFilter,isChild:!0,key:i,layer:t,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const a=y(t,s),o={[l.imageryLayerInfoStretched]:a},n={[l.imageryLayerInfoStretched]:a};return g("div",{class:l.layerRow,key:`${i}-row`},g("div",{class:this.classes(l.symbolContainer,n)},this._renderPreview(e,a)),g("div",{class:this.classes(l.layerInfo,o)},d(this.messages,r,!1)||""))}_renderPreview(e,s){const{layer:t}=this;if("preview"in e&&e.preview){const{preview:s}=e,t="previewAriaLabel"in e?e.previewAriaLabel:null,r="label"in e?d(this.messages,e.label,!1):null,i=s.querySelector("svg"),a=p(this.messages,t||r);return a&&i&&i.setAttribute("aria-label",a),g("div",{afterCreate:h,bind:s,class:l.symbol})}return"src"in e&&e.src?this._renderImage(e,t,s):null}_renderImage(e,s,t){const{previewAriaLabel:r,src:i,opacity:a}=e,o=d(this.messages,e.label,!1),n={[l.imageryLayerStretchedImage]:t,[l.symbol]:!t},m={opacity:`${a??s.opacity}`},c=p(this.messages,r||o);return g("img",{alt:c,"aria-label":c,border:0,class:this.classes(n),height:e.height,src:i,styles:m,width:e.width})}};e([s()],b.prototype,"cssEffectFilter",void 0),e([s()],b.prototype,"isChild",void 0),e([s()],b.prototype,"layer",void 0),e([s()],b.prototype,"legendElement",void 0),e([s()],b.prototype,"messages",void 0),b=f=e([t("esri.widgets.Legend.styles.classic.LegendElement")],b);export{b as default};
