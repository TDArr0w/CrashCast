/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"../../../intl.js";import{millisecondsPerTimeUnit as t}from"../../../core/timeUtils.js";import e from"../../../layers/support/DateTimeFieldFormat.js";import{supportsFieldConfiguration as n}from"../../../layers/support/layerUtils.js";import i from"../../../popup/support/FieldInfoFormat.js";import{format as o}from"../../../renderers/support/numberUtils.js";import{formatAnyDate as r}from"../../../smartMapping/support/utils.js";import l from"../../../symbols/SimpleLineSymbol.js";import{convertNumberFieldFormatToIntlOptions as A,convertNumberFormatToIntlOptions as a,formatNumber as s}from"../../../intl/number.js";const u="<",f=">";function m(t,e,n,i){let o="";0===e?o=`${u} `:e===n&&(o=`${f} `);const r=d(t,i);return null==r?"":o+r}function p(t){const{format:e,fieldFormat:n}=t||{};return"number"===n?.type||!!e&&null==e.dateFormat&&(null!=e.places||null!=e.digitSeparator)}function d(t,e){if(null==t)return t;const{fieldType:n,format:i,fieldFormat:l,timeZoneOptions:u}=e||{};if(F(n))return r(t,{fieldType:n,format:i?.dateFormat,fieldFormat:"date-time"===l?.type?l:void 0,timeZoneOptions:u});if("string"==typeof t&&p(e)){const e=Number(t);isNaN(e)||(t=e)}if("string"==typeof t)return t;const f="number"===l?.type?A(l):i?a(i):void 0;return f?s(t,f):o(t)}const c=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function g(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const e=t.visualVariables.find(t=>"color"===t.type);if(!e)return null;let n=null,i=null;if(e.stops){if(1===e.stops.length)return e.stops[0].color;n=e.stops[0].value,i=e.stops[e.stops.length-1].value}const o=null!=n&&null!=i?n+(i-n)/2:0,{getColor:r}=await import("../../../renderers/visualVariables/support/visualVariableUtils.js");return r(e,o)??null}async function w(t,e){const n=t.trailCap,i=t.trailWidth||1,o=e||await g(t)||t.color;return new l({cap:n,color:o,width:i})}function y(t,e){if(!e)return null;if("featureReduction"in t)switch(t.featureReduction?.type){case"cluster":case"binning":{const n=t.featureReduction.fields.find(({name:t})=>t.toLowerCase()===e.toLowerCase());return n&&"getField"in t?t.getField(n.onStatisticField):null}}return"getField"in t?t.getField?.(e):null}function I(t,e){const n="popupTemplate"in t?t.popupTemplate?.fieldInfos:null;if(n?.length&&e)return n.find(t=>t.fieldName?.toLowerCase()===e.toLowerCase())}function U(e){let n=0,i=0;return e.stops?(n=e.stops?.at(0)?.value??n,i=e.stops?.at(-1)?.value??i):"minDataValue"in e&&"maxDataValue"in e&&(n=e.minDataValue??n,i=e.maxDataValue??i),i-n>2*t.days?"short-date":"short-date-short-time"}function F(t){return["date","date-only","time-only","timestamp-offset"].includes(t||"")}function h(t){return n(t)&&!("featureReduction"in t&&t.featureReduction)}function V(t,n,o){const r=j(t,n.field,o);return r?(F(r.fieldType)&&(h(t)?r.fieldFormat??=new e({dateStyle:"short",timeStyle:"short-date-short-time"===U(n)?"short":null}):r.format??=new i({dateFormat:U(n)})),r):null}function j(t,e,n){const i=y(t,e),o=i?.name;if(!o)return null;const r=i?.type,l=h(t);return{fieldType:r,format:l?null:I(t,o)?.format,fieldFormat:l?t.getFieldConfiguration(o)?.fieldFormat:null,timeZoneOptions:F(r)?{layerTimeZone:"preferredTimeZone"in t?t.preferredTimeZone:null,viewTimeZone:n,datesInUnknownTimezone:"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone}:null}}function C(t,e){if("authoringInfo"in t)return t.authoringInfo?.visualVariables?.find(({theme:t})=>t===e)}function b(t,e){let n=null!=t?t:"";return null!=e&&e&&(n=n?"("+n+") AND ("+e+")":e),n}export{m as createStopLabel,d as formatValue,C as getAuthoringInfoVisualVariableByTheme,j as getFormatOptions,V as getFormatOptionsForVisualVariable,g as getMedianColor,w as getSymbolForFlowRenderer,b as mergeWhereClauses,c as rgbImgSource,f as specialCharsGreaterThan,u as specialCharsLessThan};
