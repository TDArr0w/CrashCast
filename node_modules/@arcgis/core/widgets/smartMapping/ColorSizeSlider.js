/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import r from"../../core/Error.js";import{property as i}from"../../core/accessorSupport/decorators/property.js";import"../../core/has.js";import"../../core/Logger.js";import"../../core/RandomLCG.js";import{subclass as s}from"../../core/accessorSupport/decorators/subclass.js";import{authoringInfoFirstVariableSliderMinMax as t}from"../../renderers/support/authoringInfoUtils.js";import l from"../../renderers/visualVariables/support/ColorSizeStop.js";import a from"../../renderers/visualVariables/support/ColorStop.js";import o from"../../renderers/visualVariables/support/SizeStop.js";import n from"./SmartMappingSliderBase.js";import d from"./ColorSizeSlider/ColorSizeSliderViewModel.js";import{getDynamicPathForSizeStops as p,getPathForSizeStops as m}from"./support/utils.js";import{globalCss as u}from"../support/globalCss.js";import{storeNode as h}from"../support/widgetUtils.js";import{messageBundle as c}from"../support/decorators/messageBundle.js";import{tsx as g}from"../support/jsxFactory.js";import"@arcgis/toolkit/dom";var v;const b="esri-color-size-slider",f={base:b,rampElement:`${b}__ramp`,sliderContainer:`${b}__slider-container`,histogramContainer:`${b}__histogram-container`,primaryHandle:`${b}--primary-handle`,track:`${b}--interactive-track`};let S=v=class extends n{constructor(e,r){super(e,r),this._backgroundFillColor="#e0e0e0",this._minRampFillWidth=.2,this._rampNode=null,this._maxRampFillWidth=1,this.messages=null,this.viewModel=new d,this._bgFillId=`${this.id}-bg-fill`,this._rampFillId=`${this.id}-linear-gradient`}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get primaryHandleEnabled(){return this.viewModel.primaryHandleEnabled}set primaryHandleEnabled(e){this.viewModel.primaryHandleEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}static fromRendererResult(e,i){const s=e.size.visualVariables,a=e.renderer.authoringInfo?.univariateTheme,o=e.color?.visualVariable.stops,{statistics:n}=e,{avg:d,stddev:p}=n;if(!o)throw new r("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const m="above-and-below"===a,[u,h]=t(e.renderer.authoringInfo),c=s.find(e=>"outline"!==e?.target&&!(e?.axis&&!e?.field&&!e?.valueExpression)&&(e?.field||e?.valueExpression)),g=c.stops,b=o.map((e,r)=>{const{color:i,label:s,value:t}=e;let a;return a=g&&g.length>0?g[r].size:0===r?c.minSize:r===o.length-1?c.maxSize:null,new l({color:i,label:s,value:t,size:a})});return new v({max:h,min:u,stops:b,primaryHandleEnabled:m,handlesSyncedToPrimary:m,persistSizeRangeEnabled:m,histogramConfig:{average:d??void 0,standardDeviation:p??void 0,bins:i?i.bins:[]}})}updateFromRendererResult(e,i){const s=e.size.visualVariables,a=e.renderer.authoringInfo?.univariateTheme,o=e.color?.visualVariable.stops,{statistics:n}=e,{avg:d,stddev:p}=n;if(!o)throw new r("ColorSizeSlider-fromRendererResult:invalid-renderer-result","'result' must include 'color' variable.");const m="above-and-below"===a,[u,h]=t(e.renderer.authoringInfo),c=s.find(e=>"outline"!==e?.target&&!(e?.axis&&!e?.field&&!e?.valueExpression)&&(e?.field||e?.valueExpression)),g=c.stops,v=o.map((e,r)=>{const{color:i,label:s,value:t}=e;let a;return a=g&&g.length>0?g[r].size:0===r?c.minSize:r===o.length-1?c.maxSize:null,new l({color:i,label:s,value:t,size:a})});this.set({max:h,min:u,stops:v,primaryHandleEnabled:m,handlesSyncedToPrimary:m,persistSizeRangeEnabled:m,histogramConfig:{average:d,standardDeviation:p,bins:i?i.bins:[]}})}updateRenderer(e){const{stops:r}=this,i=r[0],s=r[r.length-1],t=r[Math.floor(r.length/2)],l=e.clone(),n=l.visualVariables?.map(e=>{if("size"===e.type){if("outline"===e?.target||e?.axis&&!e?.field&&!e?.valueExpression)return e;null!=e.minSize&&null!=e.maxSize?e.set({maxDataValue:s.value,minDataValue:i.value,maxSize:s.size,minSize:i.size}):e.stops&&e.set({stops:r.map(e=>{const{label:r,size:i,value:s}=e;return new o({label:r,size:i,value:s})})})}else"color"===e.type&&e.set({stops:this.stops.map(e=>{const{color:r,label:i,value:s}=e;return new a({color:r,label:i,value:s})})});return e})??null;if(l.visualVariables=n,l.classBreakInfos.length>1){const e=t.value;l.classBreakInfos[0].maxValue=e,l.classBreakInfos[1].minValue=e}return l}updateVisualVariables(e){return e.map(e=>{const r=e.clone();if("size"===e.type){if("outline"===e?.target||e?.axis&&!e?.field&&!e?.valueExpression)return r;if(null!=e.minSize&&null!=e.maxSize){const{stops:e}=this,i=e[0],s=e[e.length-1];r.set({maxDataValue:s.value,minDataValue:i.value,maxSize:s.size,minSize:i.size})}else e.stops&&r.set({stops:this.stops.map(e=>{const{label:r,size:i,value:s}=e;return new o({label:r,size:i,value:s})})})}else"color"===e.type&&r.set({stops:this.stops.map(e=>{const{color:r,label:i,value:s}=e;return new a({color:r,label:i,value:s})})});return r})}render(){const{label:e,primaryHandleEnabled:r,state:i,visibleElements:s}=this,t="disabled"===i,l=this.classes(f.base,u.widget,u.panel,{[u.disabled]:t,[f.primaryHandle]:r,[f.track]:!!s.interactiveTrack});return g("div",{"aria-label":e,class:l},t?null:this.renderContent(this._renderRamp(),f.sliderContainer,f.histogramContainer))}_renderRamp(){const{_bgFillId:e,_rampFillId:r,viewModel:i,zoomOptions:s}=this,t=i.getStopInfo();return g("div",{afterCreate:h,bind:this,class:f.rampElement,"data-node-ref":"_rampNode"},g("svg",{xmlns:"http://www.w3.org/2000/svg"},g("defs",null,this.renderRampFillDefinition(r,t),this.renderBackgroundFillDefinition(e)),g("rect",{fill:this._backgroundFillColor,height:"100%",width:"100%",x:"0",y:"0"}),this._renderPaths()),s?this.renderZoomCaps():null)}_renderPaths(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:r=0}=this._rampNode;if(null==e||null==r)return;const{primaryHandleEnabled:i,stops:s,values:t,viewModel:{max:l,min:a},_bgFillId:o,_maxRampFillWidth:n,_minRampFillWidth:d,_rampFillId:u}=this,h=[n,d];s[0].size<s[s.length-1].size&&h.reverse();const c=t.slice().sort((e,r)=>e>r?1:-1),[v,b]=h,[f,S]=c,z=i?p({max:l,min:a,pathHeight:e,pathWidth:r,stops:s,padding:d}):m({bottomValue:f,bottomWidth:v,max:l,min:a,pathHeight:e,pathWidth:r,topValue:S,topWidth:b});return[g("path",{d:z,fill:`url(#${o})`,key:"background"}),g("path",{d:z,fill:`url(#${u})`,key:"fill"})]}};e([i()],S.prototype,"label",null),e([i(),c("esri/widgets/smartMapping/ColorSizeSlider/t9n/ColorSizeSlider")],S.prototype,"messages",void 0),e([i()],S.prototype,"persistSizeRangeEnabled",null),e([i()],S.prototype,"primaryHandleEnabled",null),e([i()],S.prototype,"stops",null),e([i({type:d})],S.prototype,"viewModel",void 0),S=v=e([s("esri.widgets.smartMapping.ColorSizeSlider")],S);const z=S;export{z as default};
