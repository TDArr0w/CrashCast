/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import{property as t}from"../../core/accessorSupport/decorators/property.js";import{cast as i}from"../../core/accessorSupport/decorators/cast.js";import"../../core/has.js";import"../../core/RandomLCG.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import{getEffectiveFieldAlias as l}from"../../editing/fieldUtils.js";import o from"../Widget.js";import{loadCalciteComponents as s}from"./componentsUtils.js";import"./widgetUtils.js";import{messageBundle as a}from"./decorators/messageBundle.js";import{tsx as n}from"./jsxFactory.js";import"@arcgis/toolkit/dom";import d from"./FilterCondition/FilterConditionViewModel.js";const p={},u="esri-filter-condition",c={base:u,valueInputContainer:`${u}__value-input-container`};let m=class extends o{constructor(e,t){super(e,t),this.messages=null,this.messagesCommon=null,this.viewModel=new d,this.visibleElements={...p}}loadDependencies(){return s({input:()=>import("@esri/calcite-components/dist/components/calcite-input"),option:()=>import("@esri/calcite-components/dist/components/calcite-option"),select:()=>import("@esri/calcite-components/dist/components/calcite-select")})}get _defaultFieldName(){const{fields:e,fieldName:t}=this;return t||(e?.length?e[0].name:void 0)}get _valueInputType(){const{viewModel:e}=this;return e.isNumericField||e.isObjectIDField?"number":"text"}get _visibleOperators(){const{field:e,operators:t,viewModel:i}=this;return e?i.isStringField||i.isGlobalIDField?t.string:i.isNumericField?t.number:i.isObjectIDField?t.id:[]:[]}get _isValueInputHidden(){const{operator:e}=this;return!!e&&["isBlank","isNotBlank","isEmpty","isNotEmpty"].includes(e)}get domain(){return this.viewModel.domain}get field(){return this.viewModel.field}get fields(){return this.viewModel.fields}get fieldLabel(){return this.viewModel.fieldLabel}get fieldName(){return this.viewModel.fieldName}set fieldName(e){this.viewModel.fieldName=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get normalizedFieldName(){return this.viewModel.normalizedFieldName}get operator(){return this.viewModel.operator}set operator(e){this.viewModel.operator=e}get operators(){return this.viewModel.operators}set operators(e){this.viewModel.operators=e}get state(){return this.viewModel.state}get value(){return this.viewModel.value}set value(e){this.viewModel.value=e}get valueAsString(){return this.viewModel.valueAsString}castVisibleElements(e){return{...p,...e}}get whereClause(){return this.viewModel.whereClause}render(){return n("div",{class:c.base},this._renderFieldSelection(),this._renderOperatorSelection(),this._renderValueInput())}_renderFieldSelection(){const{layer:e,normalizedFieldName:t}=this;return n("div",null,n("calcite-select",{afterCreate:()=>{this.fieldName||(this.fieldName=this._defaultFieldName)},bind:this,label:this.messages.chooseField,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this.value=null,this.fieldName=e.value}},this.fields.map(i=>{const r=l(i,e);return this._renderOption(i.name,r,t)})))}_renderOperatorSelection(){const{_visibleOperators:e,messages:t,operator:i}=this;if(e.length)return n("div",null,n("calcite-select",{afterUpdate:e=>{const t=e.value;this._visibleOperators.includes(t)||(this.operator=this._visibleOperators[0])},bind:this,label:t.operator,required:!0,width:"full",onCalciteSelectChange:e=>{this.operator=e.currentTarget.value}},e.map(e=>this._renderOption(e,t.operators[e],i))))}_renderOption(e,t,i){return n("calcite-option",{key:e,label:t??e,selected:e===i,value:e})}_renderValueInput(){const{valueAsString:e,domain:t,messages:i,operator:r}=this;if(!this._isValueInputHidden){if("coded-value"===t?.type&&t.codedValues.length&&("is"===r||"isNot"===r)){const r=t.codedValues[0].code;return n("div",{key:"value-select"},n("calcite-select",{afterCreate:()=>this._afterSelectCreateOrUpdate(r),afterUpdate:()=>this._afterSelectCreateOrUpdate(r),bind:this,label:i.value,required:!0,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this._onValueChange(e.value)}},t.codedValues.map(({code:t,name:i})=>this._renderOption(`${t}`,i,e))))}return n("div",{class:c.valueInputContainer,key:"value-input"},n("calcite-input",{label:i.value,type:this._valueInputType,value:e,onCalciteInputInput:({currentTarget:e})=>{this._onValueChange(e.value)}}))}}_afterSelectCreateOrUpdate(e){null==this.value&&(this.value=e)}_onValueChange(e){const{viewModel:t}=this;e&&""!==e?t.isStringField||t.isGlobalIDField?this.value=e.toString():(t.isNumericField||t.isObjectIDField)&&(this.value=parseFloat(e)):this.value=null}};e([t()],m.prototype,"_defaultFieldName",null),e([t()],m.prototype,"_valueInputType",null),e([t()],m.prototype,"_visibleOperators",null),e([t()],m.prototype,"_isValueInputHidden",null),e([t()],m.prototype,"domain",null),e([t()],m.prototype,"field",null),e([t()],m.prototype,"fields",null),e([t()],m.prototype,"fieldLabel",null),e([t()],m.prototype,"fieldName",null),e([t()],m.prototype,"layer",null),e([t(),a("esri/widgets/support/FilterCondition/t9n/FilterCondition")],m.prototype,"messages",void 0),e([t(),a("esri/t9n/common")],m.prototype,"messagesCommon",void 0),e([t()],m.prototype,"normalizedFieldName",null),e([t()],m.prototype,"operator",null),e([t()],m.prototype,"operators",null),e([t()],m.prototype,"state",null),e([t()],m.prototype,"value",null),e([t()],m.prototype,"valueAsString",null),e([t()],m.prototype,"viewModel",void 0),e([t()],m.prototype,"visibleElements",void 0),e([i("visibleElements")],m.prototype,"castVisibleElements",null),e([t()],m.prototype,"whereClause",null),m=e([r("esri.widgets.support.FilterCondition")],m);export{m as default};
