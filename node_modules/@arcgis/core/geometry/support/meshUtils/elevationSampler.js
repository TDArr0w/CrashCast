/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import{open as r}from"../../../core/workers/workers.js";import{property as t}from"../../../core/accessorSupport/decorators/property.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/RandomLCG.js";import{subclass as o}from"../../../core/accessorSupport/decorators/subclass.js";import{create as n}from"../../../core/libs/gl-matrix-2/factories/vec3f64.js";import{fromValues as s}from"../ray.js";import{intersectRay as a}from"../triangle.js";import i from"./ElevationSamplerWorker.js";import c from"../../../layers/support/ElevationSampler.js";async function l(e,r){const t=await p(),o=await d.createIndex(e,t);u(t);const n=e.spatialReference,s=e.extent.clone();return new m({spatialReference:n,extent:s,noDataValue:r?.noDataValue||0,rindex:o})}let m=class extends c{constructor(e){super(e),this.demResolution={min:0,max:0}}elevationAt(e,r){let t=Number.NEGATIVE_INFINITY;return s([e,r,0],[0,0,-1],I),this.rindex.search({minX:e,maxX:e,minY:r,maxY:r},e=>{a(e,I,N)&&N[2]>t&&(t=N[2])}),t===Number.NEGATIVE_INFINITY?this.noDataValue:t}};function p(){return++x,f(),y||(y=r("ElevationSamplerWorker").catch(()=>null),y)}function u(e){--x,null!=e&&0===x&&(j=setTimeout(()=>{e.close(),y=null,j=0},v))}function f(){j&&(clearTimeout(j),j=0)}e([t({constructOnly:!0})],m.prototype,"spatialReference",void 0),e([t({constructOnly:!0})],m.prototype,"extent",void 0),e([t({constructOnly:!0})],m.prototype,"noDataValue",void 0),e([t({constructOnly:!0})],m.prototype,"rindex",void 0),m=e([o("esri.geometry.support.meshUtils.elevationSampler")],m);const d=new i;let x=0,y=null,j=0;const v=1e4,I=s([0,0,0],[0,0,-1]),N=n();export{l as create};
