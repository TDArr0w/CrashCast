/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{p as e,c as r,e as n,a as t,r as o,l as a,b as l,d as s,f as u,s as c,g as f,h as p}from"../chunks/arcade.js";export{i as arcade}from"../chunks/arcade.js";import{ArcadeDate as m}from"../arcade/ArcadeDate.js";import{toSymbolId as d}from"../arcade/arcadeEnvironment.js";import y from"../arcade/Dictionary.js";import{Feature as v}from"../arcade/Feature.js";import{j as x,e as g,k as j,m as S,l as h}from"../chunks/languageUtils.js";export{Pixel}from"../arcade/Pixel.js";export{Voxel}from"../arcade/Voxel.js";import{clone as w}from"../core/lang.js";import{DateOnly as A}from"../core/sql/DateOnly.js";import{TimeOnly as $}from"../core/sql/TimeOnly.js";import b from"../geometry/Extent.js";import E from"../geometry/Multipoint.js";import F from"../geometry/Point.js";import P from"../geometry/Polygon.js";import C from"../geometry/Polyline.js";import{isArray as M,isString as _,isBoolean as D,isNumber as I}from"./guards.js";const R={vars:{$feature:"any",$view:"any"}};function T(e){return e.replaceAll(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function k(e){return null==e?null:M(e)||x(e)?"array":g(e)?"date":_(e)?"text":D(e)?"boolean":I(e)?"number":e instanceof y?"dictionary":j(e)?"feature":e instanceof F?"point":e instanceof P?"polygon":e instanceof C?"polyline":e instanceof E?"multipoint":e instanceof b?"extent":e instanceof A?"dateOnly":e instanceof $?"time":S(e)?"featureSet":h(e)?"featureSetCollection":null}function z(r){if(!r)return null;try{return e(r)}catch(n){}return null}function J(e,n){const t="string"==typeof e?z(e):e;if(!t)return null;try{return n=n||w(R),r(t,n)}catch(o){}return null}function V(e,r,n){return{vars:{$feature:null==e?new v:v.createFromGraphic(e,n),$view:r?.view},spatialReference:r?.sr,timeZone:n??null}}function O(e,r,n){return v.createFromGraphicLikeObject(r,e,n,null)}function Z(e,r){null!=e.vars&&(e.vars.$feature=r)}function q(e,r){let t;try{t=n(e,r)}catch(o){t=null}return t}function G(e,r){let n;try{n=e?e(r):null}catch(t){n=null}return n}function L(e,r){try{return e?e(r):Promise.resolve(null)}catch(n){return Promise.resolve(null)}}const N=["$feature","$aggregatedFeatures","$voxel"].map(e=>d(e));function U(e,r){if(!e)return[];const n="string"==typeof e?z(e):e;if(!n)return[];const o=new Map;if(Array.isArray(r)||null==r)for(const t of N)o.set(t,r);else for(const[t,i]of r)o.set(d(t),i);const a=t(n).flatMap(({varId:e,memberNamePattern:r})=>{if(!o.has(e))return[];if(r.includes("*")){const n=o.get(e);if(null==n)return[];const t=new RegExp(`^${r.split(/\*+/).map(T).join(".*")}$`,"i");return n.filter(e=>t.test(e))}return r.toLowerCase()});return[...new Set(a.sort())]}function B(e){return o(e,"$view")}function H(e,r){return!!e&&o(e,r)}function K(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;let r,n;const{timeProperties:t,timeZone:o}=e;if(null!=t){const{currentStart:e,currentEnd:a}=t;null!=o?(r=null!=e?m.dateJSAndZoneToArcadeDate(e,o):null,n=null!=a?m.dateJSAndZoneToArcadeDate(a,o):null):(r=null!=e?m.dateJSToArcadeDate(e):null,n=null!=a?m.dateJSToArcadeDate(a):null)}return{view:e.viewingMode&&null!=e.scale?new y({__proto__:null,viewingMode:e.viewingMode,scale:e.scale,timeProperties:null!=r||null!=n?new y({__proto__:null,currentStart:r,currentEnd:n,startIncluded:!0,endIncluded:!0}):null}):null,sr:e.spatialReference}}function Q({url:e,spatialReference:r,lrucache:n,interceptor:t}){const o=u();return o?o.createFeatureSetCollectionFromService(e,r,n,t):null}function W({layer:e,spatialReference:r,outFields:n,returnGeometry:t,lrucache:o,interceptor:a}){if(null===e)return null;const i=u();return i?i.constructFeatureSet(e,r,n,t??!0,o,a):null}function X(e){if(null===e?.map)return null;const r=u();return r?r.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function Y(e,r){return y.convertJsonToArcade(e,r)}function ee(e,r,n=[]){return a(e,r,n)}function re(){return l()}function ne(){return s()}function te(e){return"type"in e&&("class-breaks"===e.type||"dictionary"===e.type||"dot-density"===e.type||"pie-chart"===e.type||"simple"===e.type||"unique-value"===e.type)}function oe(e){return"esri.layers.support.LabelClass"===e.declaredClass}function ae(e){return"esri.PopupTemplate"===e.declaredClass}function ie(e,r){if(!e)return!1;if("string"==typeof e)return r(e);const n=e;if(te(n)){if("dot-density"===n.type){const e=n.attributes?.some(e=>r(e.valueExpression));if(e)return e}const e=n.visualVariables,t=!!e&&e.some(e=>{let n=r(e.valueExpression);return"size"===e.type&&(pe(e.minSize)&&(n=n||r(e.minSize.valueExpression)),pe(e.maxSize)&&(n=n||r(e.maxSize.valueExpression))),n});return!(!("valueExpression"in n)||!r(n.valueExpression))||t}if(oe(n)){const e=n.labelExpressionInfo?.expression;return!(!e||!r(e))||!1}return!!ae(n)&&(!!n.expressionInfos&&n.expressionInfos.some(e=>r(e.expression))||Array.isArray(n.content)&&n.content.some(e=>"expression"===e.type&&r(e.expressionInfo?.expression)))}function le(e){const r=z(e);return!!r&&f(r)}function se(e){return ie(e,le)}function ue(e){const r=z(e);return!!r&&p(r)}function ce(e){return ie(e,ue)}function fe(e){return ie(e,e=>{const r=z(e);return!!r&&c(r)})}function pe(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}export{y as Dictionary,v as arcadeFeature,W as convertFeatureLayerToFeatureSet,Y as convertJsonToArcade,X as convertMapToFeatureSetCollection,Q as convertServiceUrlToWorkspace,V as createExecContext,O as createFeature,J as createFunction,z as createSyntaxTree,B as dependsOnView,ne as enableFeatureSetOperations,re as enableGeometryOperations,q as evalSyntaxTree,L as executeAsyncFunction,G as executeFunction,U as extractFieldNames,k as getArcadeType,K as getViewInfo,se as hasGeometryFunctions,ce as hasGeometryOperations,H as hasVariable,ee as loadScriptDependencies,fe as requiresTrack,Z as updateExecContext};
