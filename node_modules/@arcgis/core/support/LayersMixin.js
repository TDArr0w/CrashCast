/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{__decorate as e}from"tslib";import r from"../core/Collection.js";import{referenceSetter as t}from"../core/collectionUtils.js";import o from"../core/Logger.js";import{isPromiseLike as s}from"../core/promiseUtils.js";import{property as a}from"../core/accessorSupport/decorators/property.js";import"../core/has.js";import"../core/RandomLCG.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import l from"../layers/Layer.js";function d(e,r,t){let o,s;if(e)for(let a=0,i=e.length;a<i;a++){if(o=e.at(a),o?.[r]===t)return o;if("group"===o?.type&&(s=d(o.layers,r,t),s))return s}}const n=n=>{const y=n;let h=class extends y{constructor(...e){super(...e),this.layers=new r;const t=e=>{e.parent&&e.removeFromParent()},s=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||o.getLogger(this).error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},a=e=>{e.parent=null,this.layerRemoved(e)};this.addHandles([this.layers.on("before-add",e=>{if(e.item===this)return e.preventDefault(),void o.getLogger(this).error("#add()","Cannot add layer to itself.");t(e.item)}),this.layers.on("after-add",e=>s(e.item)),this.layers.on("after-remove",e=>a(e.item))])}destroy(){const e=this.layers.toArray();for(const r of e)r.destroy();this.layers.destroy()}removeChildLayer(e){this.layers.remove(e),super.removeChildLayer?.(e)}set layers(e){this._set("layers",t(e,this._get("layers")))}add(e,r){const t=this.layers;if(r=t.getNextIndex(r),e instanceof l){const o=e;o.parent===this?this.reorder(o,r):t.add(o,r)}else s(e)?e.then(e=>{this.destroyed||this.add(e,r)}):o.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,r){const t=this.layers;let o=t.getNextIndex(r);e.slice().forEach(e=>{e.parent!==this?(t.add(e,o),o+=1):this.reorder(e,o)})}findLayerById(e){return d(this.layers,"id",e)}findLayerByUid(e){return d(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,r){return this.layers.reorder(e,r)}layerAdded(e){}layerRemoved(e){}};return e([a()],h.prototype,"layers",null),h=e([i("esri.support.LayersMixin")],h),h};export{n as LayersMixin};
